(()=>{"use strict";class t{constructor(){this.board=[],this.createBoard(),this.hits=[],this.misses=[],this.placedShips=[],this.gameOver=!1,this.sunkShips=[]}createBoard(){let t=0;for(let e=0;e<10;e++){this.board[e]=[];for(let s=0;s<10;s++)t++,this.board[e][s]=t}}placeShip(t,e,s){if(s&&!0===this.validPlacement(e,t.length,!0)){for(let s=0;s<t.length;s++){for(let s=0;s<this.board.length;s++)if(this.board[s].includes(e)){let i=this.board[s].indexOf(e);this.board[s][i]=t.name}e+=10}this.placedShips.push(t)}else if(!s&&!0===this.validPlacement(e,t.length,!1)){for(let s=0;s<t.length;s++){for(let s=0;s<this.board.length;s++)if(this.board[s].includes(e)){let i=this.board[s].indexOf(e);this.board[s][i]=t.name}e+=1}this.placedShips.push(t)}}recieveAttack(t,e){let s=t+e;Number.isInteger(this.board[t][e])?this.misses.push(s):(this.hits.push(s),this.placedShips.forEach((i=>{if(i.name===this.board[t][e])return i.hit(s),i.isSunk(),void(i.isSunk()&&this.sunkShips.push(i))})))}isOver(){return 4===this.sunkShips.length}validPlacement(t,e,s){let i=this.convertPosition(t),r=this.getRow(i),n=this.getCol(i);if(s&&r+e>10)return!1;if(!s&&n+e>10)return!1;if(s)for(let t=0;t<e;t++){if(!Number.isInteger(this.board[r][n]))return!1;r++}else for(let t=0;t<e;t++){if(!Number.isInteger(this.board[r][n]))return!1;n++}return!0}randomlyPlaceShips(t){let e,s,i=!1;for(;!i;)e=Math.floor(100*Math.random())+1,s=Math.random()<.5,this.validPlacement(e,t.length,s)?(i=!0,this.placeShip(t,e,s)):i=!1}convertPosition(t){let e,s,i=t.toString();return t<11?(e=t-1,s=0):100===t?(s=9,e=9):t%10==0?(s=parseInt(i.slice(0,1)),e=9):(s=parseInt(i.slice(0,1)),e=parseInt(i.slice(1,2))-1),s.toString()+e.toString()}getCol(t){return parseInt(t.slice(1,2))}getRow(t){return parseInt(t.slice(0,1))}}class e{constructor(e,s){this.gameboard=new t,this.name=e,this.shots=[],this.oponent=s}attack(t,e){let s=this.gameboard.convertPosition(t),i=this.gameboard.getRow(s),r=this.gameboard.getCol(s);this.shots.includes(t)||(this.shots.push(t),e.gameboard.recieveAttack(i,r),e.gameboard.isOver())}randomAttack(t){let e,s=!1;for(;!s;){e=Math.floor(100*Math.random())+1;let i=this.gameboard.convertPosition(e),r=this.gameboard.getRow(i),n=this.gameboard.getCol(i);if(!this.shots.includes(e))return console.log(e),this.shots.push(e),t.gameboard.recieveAttack(r,n),s=!0,e}}}class s{constructor(t,e){this.length=t,this.isHit=[],this.sunk=!1,this.name=e}hit(t){if(!this.isHit.includes(t)&&this.isHit.length<this.length)return this.isHit.push(t),this.isHit}isSunk(){return this.isHit.length===this.length&&(this.sunk=!0,!0)}}!function(t){document.querySelector("body");const i=document.querySelector(".grid-container1");document.querySelector(".title-1").textContent="jjcrazyman";const r=document.querySelector(".sunken1"),n=document.querySelector(".grid-container2");document.querySelector(".title-2").textContent="Computer";const o=document.querySelector(".sunken2");let a=new e("human","computer"),l=new e("computer","human"),h=a.gameboard.board,c=l.gameboard.board;const d=[new s(5,"carrier"),new s(4,"destroyer"),new s(3,"submarine"),new s(2,"patrol")];[new s(5,"carrier"),new s(4,"destroyer"),new s(3,"submarine"),new s(2,"patrol")].forEach((t=>{l.gameboard.randomlyPlaceShips(t)})),d.forEach((t=>{a.gameboard.randomlyPlaceShips(t)}));let u=0;for(let t=0;t<h.length;t++)for(let e=0;e<h[t].length;e++){u++;const s=document.createElement("div");s.setAttribute("hposition",u),Number.isInteger(h[t][e])||s.classList.add("ship-here"),s.classList.add("grid-item"),null==i||i.appendChild(s)}for(let t=0;t<c.length;t++)for(let e=0;e<c[t].length;e++){const s=document.createElement("div");s.setAttribute("cposition",c[t][e]),s.classList.add("grid-item"),s.classList.add("ai-grid"),s.addEventListener("click",(function(){if(s.classList.contains("hit")||s.classList.contains("miss"))return;if(Number.isInteger(c[t][e]))s.classList.add("miss");else{s.classList.add("hit");let i=!1;if(l.gameboard.recieveAttack(t,e),l.gameboard.placedShips.forEach((s=>{s.name===c[t][e]&&(i=s.sunk)})),i){const s=document.createElement("h2");s.textContent=c[t][e],null==o||o.appendChild(s),l.gameboard.isOver()&&alert("You win")}}let i;i=l.randomAttack(a);const n=document.querySelector(`[hposition="${i}"]`);let d=i,u=a.gameboard.convertPosition(d),m=a.gameboard.getRow(u),g=a.gameboard.getCol(u);if(Number.isInteger(a.gameboard.board[m][g]))null==n||n.classList.add("miss");else{null==n||n.classList.add("hit");let s=!1;if(a.gameboard.recieveAttack(t,e),a.gameboard.placedShips.forEach((i=>{i.name===h[t][e]&&(s=i.sunk)})),s){const s=document.createElement("h2");s.textContent=h[t][e],null==r||r.appendChild(s),a.gameboard.isOver()&&alert("You Lose")}}})),null==n||n.appendChild(s)}document.querySelectorAll(".grid-item")}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUE0Q0EsRUFBS1AsVUFBVUMsSUFBSSxZQW5CWCxDQUNwRE0sU0FBNENBLEVBQUtQLFVBQVVDLElBQUksT0FDL0QsSUFBSVEsR0FBVSxFQU9kLEdBTkFqQixFQUFNcEIsVUFBVTNCLGNBQWNiLEVBQUdDLEdBQ2pDMkQsRUFBTXBCLFVBQVU1QyxZQUFZdUIsU0FBU2hCLElBQzdCQSxFQUFLUSxPQUFTbUQsRUFBTzlELEdBQUdDLEtBQ3hCNEUsRUFBVTFFLEVBQUtnRCxLQUV0QixJQUNHMEIsRUFBUyxDQUNULE1BQU1KLEVBQVNwQixTQUFTYSxjQUFjLE1BQ3RDTyxFQUFPakIsWUFBY00sRUFBTzlELEdBQUdDLEdBQy9Cd0QsU0FBa0RBLEVBQVFhLFlBQVlHLEdBQ2xFYixFQUFNcEIsVUFBVWxCLFVBQ2hCb0QsTUFBTSxXQUVkLENBQ0osQ0FJSixJQUNBaEIsU0FBOENBLEVBQU1ZLFlBQVlMLEVBQ3BFLENBRWFaLFNBQVN5QixpQkFBaUIsYUFDL0MsQ0NoSEFDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9nYW1lYm9hcmQudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvcGxheWVycy50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9zaGlwLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdWkvcmVuZGVyR2FtZUJvYXJkcy50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IFNoaXAgfSBmcm9tICcuL3NoaXAnXHJcbmV4cG9ydCBjbGFzcyBHYW1lQm9hcmQge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5ib2FyZCA9IFtdO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgICAgICB0aGlzLmhpdHMgPSBbXTtcclxuICAgICAgICB0aGlzLm1pc3NlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMucGxhY2VkU2hpcHMgPSBbXTtcclxuICAgICAgICB0aGlzLmdhbWVPdmVyID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zdW5rU2hpcHMgPSBbXTtcclxuICAgIH1cclxuICAgIGNyZWF0ZUJvYXJkKCkge1xyXG4gICAgICAgIGxldCBjb3VudCA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbaV0gPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZFtpXVtqXSA9IGNvdW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcGxhY2VTaGlwKHNoaXAsIHN0YXJ0LCB2ZXJ0aWNhbCkge1xyXG4gICAgICAgIGlmICh2ZXJ0aWNhbCAmJiB0aGlzLnZhbGlkUGxhY2VtZW50KHN0YXJ0LCBzaGlwLmxlbmd0aCwgdHJ1ZSkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYm9hcmQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2FyZFtqXS5pbmNsdWRlcyhzdGFydCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5ib2FyZFtqXS5pbmRleE9mKHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2FyZFtqXVtpbmRleF0gPSBzaGlwLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3RhcnQgKz0gMTA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wbGFjZWRTaGlwcy5wdXNoKHNoaXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghdmVydGljYWwgJiZcclxuICAgICAgICAgICAgdGhpcy52YWxpZFBsYWNlbWVudChzdGFydCwgc2hpcC5sZW5ndGgsIGZhbHNlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5ib2FyZC5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJvYXJkW2pdLmluY2x1ZGVzKHN0YXJ0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmJvYXJkW2pdLmluZGV4T2Yoc3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvYXJkW2pdW2luZGV4XSA9IHNoaXAubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzdGFydCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGxhY2VkU2hpcHMucHVzaChzaGlwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZWNpZXZlQXR0YWNrKHJvdywgY29sdW1uKSB7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gcm93ICsgY29sdW1uO1xyXG4gICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih0aGlzLmJvYXJkW3Jvd11bY29sdW1uXSkpIHtcclxuICAgICAgICAgICAgdGhpcy5oaXRzLnB1c2gocG9zaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnBsYWNlZFNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzaGlwLm5hbWUgPT09IHRoaXMuYm9hcmRbcm93XVtjb2x1bW5dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hpcC5oaXQocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNoaXAuaXNTdW5rKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNoaXAuaXNTdW5rKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdW5rU2hpcHMucHVzaChzaGlwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWlzc2VzLnB1c2gocG9zaXRpb24pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaXNPdmVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnN1bmtTaGlwcy5sZW5ndGggPT09IDQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHZhbGlkUGxhY2VtZW50KHBvc2l0aW9uLCBsZW5ndGgsIGlzVmVydGljYWwpIHtcclxuICAgICAgICBsZXQgbmV3UG9zaXRpb24gPSB0aGlzLmNvbnZlcnRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgICAgbGV0IHJvdyA9IHRoaXMuZ2V0Um93KG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICBsZXQgY29sdW1uID0gdGhpcy5nZXRDb2wobmV3UG9zaXRpb24pO1xyXG4gICAgICAgIGlmIChpc1ZlcnRpY2FsICYmIHJvdyArIGxlbmd0aCA+IDEwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIWlzVmVydGljYWwgJiYgY29sdW1uICsgbGVuZ3RoID4gMTApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNWZXJ0aWNhbCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih0aGlzLmJvYXJkW3Jvd11bY29sdW1uXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKSB7XHJcbiAgICAgICAgbGV0IHZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uO1xyXG4gICAgICAgIGxldCBkaXJlY3Rpb247XHJcbiAgICAgICAgd2hpbGUgKCF2YWxpZCkge1xyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCkgKyAxO1xyXG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZhbGlkUGxhY2VtZW50KHBvc2l0aW9uLCBzaGlwLmxlbmd0aCwgZGlyZWN0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGFjZVNoaXAoc2hpcCwgcG9zaXRpb24sIGRpcmVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb252ZXJ0UG9zaXRpb24ocG9zaXRpb24pIHtcclxuICAgICAgICBsZXQgY29sdW1uO1xyXG4gICAgICAgIGxldCBzdHIgPSBwb3NpdGlvbi50b1N0cmluZygpO1xyXG4gICAgICAgIGxldCByb3c7XHJcbiAgICAgICAgaWYgKHBvc2l0aW9uIDwgMTEpIHtcclxuICAgICAgICAgICAgY29sdW1uID0gcG9zaXRpb24gLSAxO1xyXG4gICAgICAgICAgICByb3cgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChwb3NpdGlvbiA9PT0gMTAwKSB7XHJcbiAgICAgICAgICAgIHJvdyA9IDk7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IDk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBvc2l0aW9uICUgMTAgPT09IDApIHtcclxuICAgICAgICAgICAgcm93ID0gcGFyc2VJbnQoc3RyLnNsaWNlKDAsIDEpKTtcclxuICAgICAgICAgICAgY29sdW1uID0gOTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJvdyA9IHBhcnNlSW50KHN0ci5zbGljZSgwLCAxKSk7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IHBhcnNlSW50KHN0ci5zbGljZSgxLCAyKSkgLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc3RyUm93ID0gcm93LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgbGV0IHN0ckNvbCA9IGNvbHVtbi50b1N0cmluZygpO1xyXG4gICAgICAgIGxldCBuZXdQb3NpdGlvbiA9IHN0clJvdyArIHN0ckNvbDtcclxuICAgICAgICByZXR1cm4gbmV3UG9zaXRpb247XHJcbiAgICB9XHJcbiAgICBnZXRDb2woc3RyKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHN0ci5zbGljZSgxLCAyKSk7XHJcbiAgICB9XHJcbiAgICBnZXRSb3coc3RyKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHN0ci5zbGljZSgwLCAxKSk7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgR2FtZUJvYXJkIH0gZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XHJcbmV4cG9ydCBjbGFzcyBQbGF5ZXIge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgb3BvbmVudCkge1xyXG4gICAgICAgIHRoaXMuZ2FtZWJvYXJkID0gbmV3IEdhbWVCb2FyZCgpO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5zaG90cyA9IFtdO1xyXG4gICAgICAgIHRoaXMub3BvbmVudCA9IG9wb25lbnQ7XHJcbiAgICB9XHJcbiAgICBhdHRhY2socG9zaXRpb24sIG9wb25lbnQpIHtcclxuICAgICAgICBsZXQgbmV3UG9zaXRpb24gPSB0aGlzLmdhbWVib2FyZC5jb252ZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgICAgIGxldCByb3cgPSB0aGlzLmdhbWVib2FyZC5nZXRSb3cobmV3UG9zaXRpb24pO1xyXG4gICAgICAgIGxldCBjb2wgPSB0aGlzLmdhbWVib2FyZC5nZXRDb2wobmV3UG9zaXRpb24pO1xyXG4gICAgICAgIGlmICghdGhpcy5zaG90cy5pbmNsdWRlcyhwb3NpdGlvbikpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG90cy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgb3BvbmVudC5nYW1lYm9hcmQucmVjaWV2ZUF0dGFjayhyb3csIGNvbCk7XHJcbiAgICAgICAgICAgIGlmIChvcG9uZW50LmdhbWVib2FyZC5pc092ZXIoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJnZ1wiKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmFuZG9tQXR0YWNrKG9wcG9uZW50KSB7XHJcbiAgICAgICAgbGV0IHZhbGlkU2hvdCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBwb3NpdGlvbjtcclxuICAgICAgICB3aGlsZSAoIXZhbGlkU2hvdCkge1xyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCkgKyAxO1xyXG4gICAgICAgICAgICBsZXQgbmV3UG9zaXRpb24gPSB0aGlzLmdhbWVib2FyZC5jb252ZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgICAgICAgICBsZXQgcm93ID0gdGhpcy5nYW1lYm9hcmQuZ2V0Um93KG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICAgICAgbGV0IGNvbCA9IHRoaXMuZ2FtZWJvYXJkLmdldENvbChuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zaG90cy5pbmNsdWRlcyhwb3NpdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdHMucHVzaChwb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBvcHBvbmVudC5nYW1lYm9hcmQucmVjaWV2ZUF0dGFjayhyb3csIGNvbCk7XHJcbiAgICAgICAgICAgICAgICB2YWxpZFNob3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0IHN0cjogc3RyaW5nXHJcbiAgICAgICAgICAgICAgICAvLyBzdHIgPSByb3cudG9TdHJpbmcoKSArIGNvbC50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFNoaXAge1xyXG4gICAgY29uc3RydWN0b3IobGVuZ3RoLCBuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XHJcbiAgICAgICAgdGhpcy5pc0hpdCA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3VuayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB9XHJcbiAgICBoaXQocG9zaXRpb24pIHtcclxuICAgICAgICAvL3B1c2ggcG9zaXRpb24gdG8gaXNoaXQgYXJyYXlcclxuICAgICAgICBpZiAoIXRoaXMuaXNIaXQuaW5jbHVkZXMocG9zaXRpb24pICYmIHRoaXMuaXNIaXQubGVuZ3RoIDwgdGhpcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0hpdC5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNIaXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaXNTdW5rKCkge1xyXG4gICAgICAgIC8vY2hlY2tzIGVhY2ggcG9zaXRpb24gb2Ygc2hpcCBmb3IgaGl0cyBpZiBhbGwgYXJlIGhpdCBpcyBzdW5rXHJcbiAgICAgICAgaWYgKHRoaXMuaXNIaXQubGVuZ3RoID09PSB0aGlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1bmsgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9mYWN0b3JpZXMvcGxheWVyc1wiO1xyXG5pbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4uL2ZhY3Rvcmllcy9zaGlwXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlbmRlckdyaWRzKHBsYXllck5hbWUpIHtcclxuICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgICBjb25zdCBncmlkMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLWNvbnRhaW5lcjEnKTtcclxuICAgIGNvbnN0IHRpdGxlMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aXRsZS0xJyk7XHJcbiAgICB0aXRsZTEudGV4dENvbnRlbnQgPSBwbGF5ZXJOYW1lO1xyXG4gICAgY29uc3Qgc3Vua2VuMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdW5rZW4xJyk7XHJcbiAgICBjb25zdCBncmlkMiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLWNvbnRhaW5lcjInKTtcclxuICAgIGNvbnN0IHRpdGxlMiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aXRsZS0yJyk7XHJcbiAgICB0aXRsZTIudGV4dENvbnRlbnQgPSBcIkNvbXB1dGVyXCI7XHJcbiAgICBjb25zdCBzdW5rZW4yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1bmtlbjInKTtcclxuICAgIGxldCBodW1hbiA9IG5ldyBQbGF5ZXIoXCJodW1hblwiLCBcImNvbXB1dGVyXCIpO1xyXG4gICAgbGV0IGNvbXB1dGVyID0gbmV3IFBsYXllcihcImNvbXB1dGVyXCIsIFwiaHVtYW5cIik7XHJcbiAgICBsZXQgaEJvYXJkID0gaHVtYW4uZ2FtZWJvYXJkLmJvYXJkO1xyXG4gICAgbGV0IGNCb2FyZCA9IGNvbXB1dGVyLmdhbWVib2FyZC5ib2FyZDtcclxuICAgIGxldCBoQ2FycmllciA9IG5ldyBTaGlwKDUsIFwiY2FycmllclwiKTtcclxuICAgIGxldCBoRGVzdHJveWVyID0gbmV3IFNoaXAoNCwgXCJkZXN0cm95ZXJcIik7XHJcbiAgICBsZXQgaFN1Ym1hcmluZSA9IG5ldyBTaGlwKDMsIFwic3VibWFyaW5lXCIpO1xyXG4gICAgbGV0IGhQYXRyb2wgPSBuZXcgU2hpcCgyLCBcInBhdHJvbFwiKTtcclxuICAgIGxldCBjQ2FycmllciA9IG5ldyBTaGlwKDUsIFwiY2FycmllclwiKTtcclxuICAgIGxldCBjRGVzdHJveWVyID0gbmV3IFNoaXAoNCwgXCJkZXN0cm95ZXJcIik7XHJcbiAgICBsZXQgY1N1Ym1hcmluZSA9IG5ldyBTaGlwKDMsIFwic3VibWFyaW5lXCIpO1xyXG4gICAgbGV0IGNQYXRyb2wgPSBuZXcgU2hpcCgyLCBcInBhdHJvbFwiKTtcclxuICAgIGNvbnN0IGh1bWFuU2hpcHMgPSBbaENhcnJpZXIsIGhEZXN0cm95ZXIsIGhTdWJtYXJpbmUsIGhQYXRyb2xdO1xyXG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9IFtjQ2FycmllciwgY0Rlc3Ryb3llciwgY1N1Ym1hcmluZSwgY1BhdHJvbF07XHJcbiAgICAvLyBhbGxTaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xyXG4gICAgLy8gICAgIGNvbXB1dGVyLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICAvLyAgICAgaHVtYW4uZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgIC8vIH0pXHJcbiAgICBjb21wdXRlclNoaXBzLmZvckVhY2goc2hpcCA9PiB7XHJcbiAgICAgICAgY29tcHV0ZXIuZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgIH0pO1xyXG4gICAgaHVtYW5TaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xyXG4gICAgICAgIGh1bWFuLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICB9KTtcclxuICAgIGxldCBjb3VudCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhCb2FyZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaEJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGdyaWRJdGVtLnNldEF0dHJpYnV0ZShcImhwb3NpdGlvblwiLCBjb3VudCk7XHJcbiAgICAgICAgICAgIC8vIGdyaWRJdGVtLnRleHRDb250ZW50ID0gYm9hcmRbaV1bal1cclxuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGhCb2FyZFtpXVtqXSkpIHtcclxuICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ3NoaXAtaGVyZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ2dyaWQtaXRlbScpO1xyXG4gICAgICAgICAgICBncmlkMSA9PT0gbnVsbCB8fCBncmlkMSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY0JvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjQm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiY3Bvc2l0aW9uXCIsIGNCb2FyZFtpXVtqXSk7XHJcbiAgICAgICAgICAgIC8vIGdyaWRJdGVtLnRleHRDb250ZW50ID0gYm9hcmRbaV1bal1cclxuICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZCgnZ3JpZC1pdGVtJyk7XHJcbiAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ2FpLWdyaWQnKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ3JpZEl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaXQnKSB8fCBncmlkSXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ21pc3MnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihjQm9hcmRbaV1bal0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZCgnaGl0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlzU3VuayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXB1dGVyLmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKGksIGopO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXB1dGVyLmdhbWVib2FyZC5wbGFjZWRTaGlwcy5mb3JFYWNoKChzaGlwID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNoaXAubmFtZSA9PT0gY0JvYXJkW2ldW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N1bmsgPSBzaGlwLnN1bms7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3Vuaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdW5rZW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW5rZW4udGV4dENvbnRlbnQgPSBjQm9hcmRbaV1bal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bmtlbjIgPT09IG51bGwgfHwgc3Vua2VuMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3Vua2VuMi5hcHBlbmRDaGlsZChzdW5rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tcHV0ZXIuZ2FtZWJvYXJkLmlzT3ZlcigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIllvdSB3aW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKCdtaXNzJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IGNvbXB1dGVyLnJhbmRvbUF0dGFjayhodW1hbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2hwb3NpdGlvbj1cIiR7cG9zaXRpb259XCJdYCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IHBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gaHVtYW4uZ2FtZWJvYXJkLmNvbnZlcnRQb3NpdGlvbih0ZW1wKTtcclxuICAgICAgICAgICAgICAgIGxldCByb3cgPSBodW1hbi5nYW1lYm9hcmQuZ2V0Um93KG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIGxldCBjb2wgPSBodW1hbi5nYW1lYm9hcmQuZ2V0Q29sKG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihodW1hbi5nYW1lYm9hcmQuYm9hcmRbcm93XVtjb2xdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5jbGFzc0xpc3QuYWRkKCdoaXQnKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaXNTdW5rMSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGh1bWFuLmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKGksIGopO1xyXG4gICAgICAgICAgICAgICAgICAgIGh1bWFuLmdhbWVib2FyZC5wbGFjZWRTaGlwcy5mb3JFYWNoKChzaGlwID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNoaXAubmFtZSA9PT0gaEJvYXJkW2ldW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N1bmsxID0gc2hpcC5zdW5rO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N1bmsxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1bmtlbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bmtlbi50ZXh0Q29udGVudCA9IGhCb2FyZFtpXVtqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vua2VuMSA9PT0gbnVsbCB8fCBzdW5rZW4xID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdW5rZW4xLmFwcGVuZENoaWxkKHN1bmtlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChodW1hbi5nYW1lYm9hcmQuaXNPdmVyKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiWW91IExvc2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uY2xhc3NMaXN0LmFkZCgnbWlzcycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZ3JpZDIgPT09IG51bGwgfHwgZ3JpZDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGdyaWQyLmFwcGVuZENoaWxkKGdyaWRJdGVtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBncmlkSXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncmlkLWl0ZW0nKTtcclxufVxyXG4iLCIvLyBpbXBvcnQgJy4vc3R5bGVzLmNzcydcclxuaW1wb3J0IHJlbmRlckdyaWRzIGZyb20gXCIuL3VpL3JlbmRlckdhbWVCb2FyZHNcIjtcclxuLy8gc3RhcnRHYW1lKClcclxucmVuZGVyR3JpZHMoJ2pqY3JhenltYW4nKTtcclxuIl0sIm5hbWVzIjpbIkdhbWVCb2FyZCIsImNvbnN0cnVjdG9yIiwidGhpcyIsImJvYXJkIiwiY3JlYXRlQm9hcmQiLCJoaXRzIiwibWlzc2VzIiwicGxhY2VkU2hpcHMiLCJnYW1lT3ZlciIsInN1bmtTaGlwcyIsImNvdW50IiwiaSIsImoiLCJwbGFjZVNoaXAiLCJzaGlwIiwic3RhcnQiLCJ2ZXJ0aWNhbCIsInZhbGlkUGxhY2VtZW50IiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJpbmRleCIsImluZGV4T2YiLCJuYW1lIiwicHVzaCIsInJlY2lldmVBdHRhY2siLCJyb3ciLCJjb2x1bW4iLCJwb3NpdGlvbiIsIk51bWJlciIsImlzSW50ZWdlciIsImZvckVhY2giLCJoaXQiLCJpc1N1bmsiLCJpc092ZXIiLCJpc1ZlcnRpY2FsIiwibmV3UG9zaXRpb24iLCJjb252ZXJ0UG9zaXRpb24iLCJnZXRSb3ciLCJnZXRDb2wiLCJyYW5kb21seVBsYWNlU2hpcHMiLCJkaXJlY3Rpb24iLCJ2YWxpZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInN0ciIsInRvU3RyaW5nIiwicGFyc2VJbnQiLCJzbGljZSIsIlBsYXllciIsIm9wb25lbnQiLCJnYW1lYm9hcmQiLCJzaG90cyIsImF0dGFjayIsImNvbCIsInJhbmRvbUF0dGFjayIsIm9wcG9uZW50IiwidmFsaWRTaG90IiwiY29uc29sZSIsImxvZyIsIlNoaXAiLCJpc0hpdCIsInN1bmsiLCJwbGF5ZXJOYW1lIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZ3JpZDEiLCJ0ZXh0Q29udGVudCIsInN1bmtlbjEiLCJncmlkMiIsInN1bmtlbjIiLCJodW1hbiIsImNvbXB1dGVyIiwiaEJvYXJkIiwiY0JvYXJkIiwiaHVtYW5TaGlwcyIsImdyaWRJdGVtIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZENoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5zIiwic3Vua2VuIiwiYWxlcnQiLCJpdGVtIiwidGVtcCIsImlzU3VuazEiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVuZGVyR3JpZHMiXSwic291cmNlUm9vdCI6IiJ9