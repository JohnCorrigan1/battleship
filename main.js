(()=>{"use strict";class e{constructor(){this.board=[],this.createBoard(),this.hits=[],this.misses=[],this.placedShips=[],this.gameOver=!1,this.sunkShips=[]}createBoard(){let e=0;for(let t=0;t<10;t++){this.board[t]=[];for(let n=0;n<10;n++)e++,this.board[t][n]=e}}placeShip(e,t,n){if(n&&!0===this.validPlacement(t,e.length,!0)){for(let n=0;n<e.length;n++){for(let n=0;n<this.board.length;n++)if(this.board[n].includes(t)){let s=this.board[n].indexOf(t);this.board[n][s]=e.name}t+=10}this.placedShips.push(e)}else if(!n&&!0===this.validPlacement(t,e.length,!1)){for(let n=0;n<e.length;n++){for(let n=0;n<this.board.length;n++)if(this.board[n].includes(t)){let s=this.board[n].indexOf(t);this.board[n][s]=e.name}t+=1}this.placedShips.push(e)}}recieveAttack(e,t){let n=e+t;Number.isInteger(this.board[e][t])?this.misses.push(n):(this.hits.push(n),this.placedShips.forEach((s=>{if(s.name===this.board[e][t])return s.hit(n),s.isSunk(),void(s.isSunk()&&this.sunkShips.push(s))})))}isOver(){return 4===this.sunkShips.length}validPlacement(e,t,n){let s=this.convertPosition(e),i=this.getRow(s),r=this.getCol(s);if(n&&i+t>10)return!1;if(!n&&r+t>10)return!1;if(n)for(let e=0;e<t;e++){if(!Number.isInteger(this.board[i][r]))return!1;i++}else for(let e=0;e<t;e++){if(!Number.isInteger(this.board[i][r]))return!1;r++}return!0}randomlyPlaceShips(e){let t,n,s=!1;for(;!s;)t=Math.floor(100*Math.random())+1,n=Math.random()<.5,this.validPlacement(t,e.length,n)?(s=!0,this.placeShip(e,t,n)):s=!1}convertPosition(e){let t,n,s=e.toString();return e<11?(t=e-1,n=0):100===e?(n=9,t=9):e%10==0?(n=parseInt(s.slice(0,1)),t=9):(n=parseInt(s.slice(0,1)),t=parseInt(s.slice(1,2))-1),n.toString()+t.toString()}getCol(e){return parseInt(e.slice(1,2))}getRow(e){return parseInt(e.slice(0,1))}}class t{constructor(t,n){this.gameboard=new e,this.name=t,this.shots=[],this.oponent=n}attack(e,t){let n=this.gameboard.convertPosition(e),s=this.gameboard.getRow(n),i=this.gameboard.getCol(n);this.shots.includes(e)||(this.shots.push(e),t.gameboard.recieveAttack(s,i),t.gameboard.isOver())}randomAttack(e){let t,n=!1;for(;!n;){t=Math.floor(100*Math.random())+1;let s=this.gameboard.convertPosition(t),i=this.gameboard.getRow(s),r=this.gameboard.getCol(s);if(!this.shots.includes(t))return this.shots.push(t),e.gameboard.recieveAttack(i,r),n=!0,t}}}class n{constructor(e,t){this.length=e,this.isHit=[],this.sunk=!1,this.name=t}hit(e){if(!this.isHit.includes(e)&&this.isHit.length<this.length)return this.isHit.push(e),this.isHit}isSunk(){return this.isHit.length===this.length&&(this.sunk=!0,!0)}}let s=new t("human","computer"),i=new t("computer","human"),r=s.gameboard.board,a=i.gameboard.board,o=new n(5,"carrier"),l=new n(4,"destroyer"),c=new n(3,"submarine"),d=new n(2,"patrol"),u=new n(5,"carrier"),h=new n(4,"destroyer"),m=new n(3,"submarine"),p=new n(2,"patrol");const g=[o,l,c,d],b=[u,h,m,p];function f(e){const t=[];let n;const u=document.querySelector(".info");null==u||u.classList.remove("info"),null==u||u.classList.add("hide");const h=document.querySelector(".place");null==h||h.classList.remove("hide");const m=document.querySelector(".grid-container");document.querySelector(".title-1").textContent=e;const p=document.querySelector(".ships"),f=document.querySelector(".rotate"),S=document.querySelector(".carrier"),v=document.querySelector(".destroyer"),L=document.querySelector(".submarine"),y=document.querySelector(".patrol");null==f||f.addEventListener("click",(function(){(null==S?void 0:S.classList.contains("rotated"))?(null==p||p.classList.remove("ships-horizontal"),null==p||p.classList.add("ships-vertical"),S.classList.remove("rotated"),null==v||v.classList.remove("rotated"),null==L||L.classList.remove("rotated"),null==y||y.classList.remove("rotated")):(null==p||p.classList.remove("ships-vertical"),null==p||p.classList.add("ships-horizontal"),null==S||S.classList.add("rotated"),null==v||v.classList.add("rotated"),null==L||L.classList.add("rotated"),null==y||y.classList.add("rotated"))}));const C=document.querySelector(".start-game");null==C||C.addEventListener("click",(function(){h.innerHTML="",function(e){document.querySelector("body");const t=document.querySelector(".place");null==t||t.classList.add("hide");const n=document.querySelector("#main");n.classList.remove("hide"),n.classList.add("main"),document.querySelector(".content"),document.querySelector(".grid1");const o=document.querySelector(".grid-container1");document.querySelector(".title-1").textContent=e;const l=document.querySelector(".sunken1"),c=(document.querySelector(".grid2"),document.querySelector(".grid-container2"));document.querySelector(".title-2").textContent="Computer";const d=document.querySelector(".sunken2"),u=document.querySelector(".who-won"),h=document.createElement("button");h.classList.add("restart"),h.textContent="Restart",h.addEventListener("click",(function(){location.reload()})),b.forEach((e=>{i.gameboard.randomlyPlaceShips(e)}));let m=0;for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++){m++;const n=document.createElement("div");n.setAttribute("hposition",m),Number.isInteger(r[e][t])||n.classList.add("ship-here"),n.classList.add("grid-item"),null==o||o.appendChild(n)}for(let t=0;t<a.length;t++)for(let n=0;n<a[t].length;n++){const o=document.createElement("div");o.setAttribute("cposition",a[t][n]),o.classList.add("grid-item"),o.classList.add("ai-grid"),o.addEventListener("click",(function(){if(o.classList.contains("hit")||o.classList.contains("miss")||s.gameboard.isOver()||i.gameboard.isOver())return;if(Number.isInteger(a[t][n]))o.classList.add("miss");else{o.classList.add("hit");let s=!1;if(i.gameboard.recieveAttack(t,n),i.gameboard.placedShips.forEach((e=>{e.name===a[t][n]&&(s=e.sunk)})),s){const s=document.createElement("h2");if(s.textContent=a[t][n],null==d||d.appendChild(s),i.gameboard.isOver()){const t=document.createElement("h1");t.textContent="Winner: "+e+"!",null==u||u.appendChild(t),null==u||u.appendChild(h)}}}let c;c=i.randomAttack(s);const m=document.querySelector(`[hposition="${c}"]`);let p=c,g=s.gameboard.convertPosition(p),b=s.gameboard.getRow(g),f=s.gameboard.getCol(g);if(Number.isInteger(s.gameboard.board[b][f]))null==m||m.classList.add("miss");else{null==m||m.classList.remove("ship-here"),null==m||m.classList.add("hit");let e=!1;if(s.gameboard.recieveAttack(t,n),s.gameboard.placedShips.forEach((t=>{t.name===r[b][f]&&(e=t.sunk)})),e){const e=document.createElement("h2");if(e.textContent=r[b][f],null==l||l.appendChild(e),s.gameboard.isOver()){const e=document.createElement("h1");e.textContent="Winner: Computer!",null==u||u.appendChild(e),null==u||u.appendChild(h)}}}})),null==c||c.appendChild(o)}}(e)}));let E=0;for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++){E++;const e=document.createElement("div");e.setAttribute("data-hposition",E),e.classList.add("grid-item"),null==m||m.appendChild(e)}const q=document.querySelector(".randomly-place");function k(){m.innerHTML="";let e=0;for(let t=0;t<r.length;t++)for(let n=0;n<r[t].length;n++){e++;const s=document.createElement("div");s.setAttribute("hposition",e),Number.isInteger(r[t][n])||s.classList.add("ship-here"),s.classList.add("grid-item"),null==m||m.appendChild(s)}}null==q||q.addEventListener("click",(function(){g.forEach((e=>{s.gameboard.randomlyPlaceShips(e)})),q.disabled=!0,m.innerHTML="",k()})),document.querySelectorAll(".draggable").forEach((e=>{e.addEventListener("dragend",(e=>{const i=e.target,a=parseInt(n.dataset.hposition),u=[i.id,a];var h;t.push(u),4===(h=t).length&&(h.forEach((e=>{!function(e,t){"carrier"===t&&(S.classList.contains("rotated")?s.gameboard.placeShip(o,e,!1):s.gameboard.placeShip(o,e,!0)),"destroyer"===t&&(S.classList.contains("rotated")?s.gameboard.placeShip(l,e,!1):s.gameboard.placeShip(l,e,!0)),"submarine"===t&&(S.classList.contains("rotated")?s.gameboard.placeShip(c,e,!1):s.gameboard.placeShip(c,e,!0)),"patrol"===t&&(S.classList.contains("rotated")?s.gameboard.placeShip(d,e,!1):s.gameboard.placeShip(d,e,!0))}(e[1],e[0])})),console.log(r),m.innerHTML="",k())}))})),document.querySelectorAll(".grid-item").forEach((e=>{e.addEventListener("dragover",(e=>{n=e.target}))}))}!function(){const e=document.querySelector(".info"),t=document.createElement("div");t.classList.add("input-container");const n=document.createElement("label");n.textContent="Enter Name:";const s=document.createElement("input");s.classList.add("name-input");const i=document.createElement("button");i.classList.add("start-button"),i.textContent="Start",t.appendChild(n),t.appendChild(s),t.appendChild(i),null==e||e.appendChild(t),i.addEventListener("click",(function(){if(""!==s.value){const n=s.value;null==e||e.removeChild(t),f(n)}else{const n="To lazy to enter a name";null==e||e.removeChild(t),f(n)}}))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDWnFCLEVBQU1XLFVBQVksR0FDbEJvQixJQXZEb0MsR0FHbEMsSUFFV3JDLFNBQVN1QyxpQkFBaUIsY0FDbEN2RixTQUFRZ0YsSUFDYkEsRUFBS2xCLGlCQUFpQixZQUFhdUMsSUFDL0J4RyxFQUFXd0csRUFBRVYsTUFBTSxHQUVyQixHQW1EZCxFRXJMZSxXQUNYLE1BQU01QyxFQUFPQyxTQUFTQyxjQUFjLFNBQzlCcUQsRUFBaUJ0RCxTQUFTd0IsY0FBYyxPQUM5QzhCLEVBQWVwRCxVQUFVRSxJQUFJLG1CQUM3QixNQUFNbUQsRUFBWXZELFNBQVN3QixjQUFjLFNBQ3pDK0IsRUFBVWhELFlBQWMsY0FDeEIsTUFBTWlELEVBQVl4RCxTQUFTd0IsY0FBYyxTQUN6Q2dDLEVBQVV0RCxVQUFVRSxJQUFJLGNBQ3hCLE1BQU1ZLEVBQWNoQixTQUFTd0IsY0FBYyxVQUMzQ1IsRUFBWWQsVUFBVUUsSUFBSSxnQkFDMUJZLEVBQVlULFlBQWMsUUFDMUIrQyxFQUFlekIsWUFBWTBCLEdBQzNCRCxFQUFlekIsWUFBWTJCLEdBQzNCRixFQUFlekIsWUFBWWIsR0FDM0JqQixTQUE0Q0EsRUFBSzhCLFlBQVl5QixHQUM3RHRDLEVBQVlGLGlCQUFpQixTQUFTLFdBQ2xDLEdBQXdCLEtBQXBCMEMsRUFBVUMsTUFBYyxDQUN4QixNQUFNakgsRUFBT2dILEVBQVVDLE1BQ3ZCMUQsU0FBNENBLEVBQUsyRCxZQUFZSixHQUM3RHZILEVBQVVTLEVBQ2QsS0FDSyxDQUNELE1BQU1BLEVBQU8sMEJBQ2J1RCxTQUE0Q0EsRUFBSzJELFlBQVlKLEdBQzdEdkgsRUFBVVMsRUFDZCxDQUNKLEdBQ0osQ0MzQkFtSCxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvZ2FtZWJvYXJkLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL3BsYXllcnMudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvc2hpcC50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VpL3BsYWNlU2hpcC50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VpL3JlbmRlckdhbWVCb2FyZHMudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91aS9zdGFydEdhbWUudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgeyBTaGlwIH0gZnJvbSAnLi9zaGlwJ1xyXG5leHBvcnQgY2xhc3MgR2FtZUJvYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuYm9hcmQgPSBbXTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICAgICAgdGhpcy5oaXRzID0gW107XHJcbiAgICAgICAgdGhpcy5taXNzZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnBsYWNlZFNoaXBzID0gW107XHJcbiAgICAgICAgdGhpcy5nYW1lT3ZlciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc3Vua1NoaXBzID0gW107XHJcbiAgICB9XHJcbiAgICBjcmVhdGVCb2FyZCgpIHtcclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmJvYXJkW2ldID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbaV1bal0gPSBjb3VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHBsYWNlU2hpcChzaGlwLCBzdGFydCwgdmVydGljYWwpIHtcclxuICAgICAgICBpZiAodmVydGljYWwgJiYgdGhpcy52YWxpZFBsYWNlbWVudChzdGFydCwgc2hpcC5sZW5ndGgsIHRydWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmJvYXJkLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRbal0uaW5jbHVkZXMoc3RhcnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuYm9hcmRbal0uaW5kZXhPZihzdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbal1baW5kZXhdID0gc2hpcC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN0YXJ0ICs9IDEwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGxhY2VkU2hpcHMucHVzaChzaGlwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXZlcnRpY2FsICYmXHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRQbGFjZW1lbnQoc3RhcnQsIHNoaXAubGVuZ3RoLCBmYWxzZSkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYm9hcmQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2FyZFtqXS5pbmNsdWRlcyhzdGFydCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5ib2FyZFtqXS5pbmRleE9mKHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2FyZFtqXVtpbmRleF0gPSBzaGlwLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3RhcnQgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVjaWV2ZUF0dGFjayhyb3csIGNvbHVtbikge1xyXG4gICAgICAgIGxldCBwb3NpdGlvbiA9IHJvdyArIGNvbHVtbjtcclxuICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGl0cy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5wbGFjZWRTaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hpcC5uYW1lID09PSB0aGlzLmJvYXJkW3Jvd11bY29sdW1uXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNoaXAuaGl0KHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwLmlzU3VuaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vua1NoaXBzLnB1c2goc2hpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1pc3Nlcy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlzT3ZlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5zdW5rU2hpcHMubGVuZ3RoID09PSA0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB2YWxpZFBsYWNlbWVudChwb3NpdGlvbiwgbGVuZ3RoLCBpc1ZlcnRpY2FsKSB7XHJcbiAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gdGhpcy5jb252ZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgICAgIGxldCByb3cgPSB0aGlzLmdldFJvdyhuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgbGV0IGNvbHVtbiA9IHRoaXMuZ2V0Q29sKG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICBpZiAoaXNWZXJ0aWNhbCAmJiByb3cgKyBsZW5ndGggPiAxMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCFpc1ZlcnRpY2FsICYmIGNvbHVtbiArIGxlbmd0aCA+IDEwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHRoaXMuYm9hcmRbcm93XVtjb2x1bW5dKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByYW5kb21seVBsYWNlU2hpcHMoc2hpcCkge1xyXG4gICAgICAgIGxldCB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBwb3NpdGlvbjtcclxuICAgICAgICBsZXQgZGlyZWN0aW9uO1xyXG4gICAgICAgIHdoaWxlICghdmFsaWQpIHtcclxuICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMTtcclxuICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpIHtcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy52YWxpZFBsYWNlbWVudChwb3NpdGlvbiwgc2hpcC5sZW5ndGgsIGRpcmVjdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2VTaGlwKHNoaXAsIHBvc2l0aW9uLCBkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29udmVydFBvc2l0aW9uKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgbGV0IGNvbHVtbjtcclxuICAgICAgICBsZXQgc3RyID0gcG9zaXRpb24udG9TdHJpbmcoKTtcclxuICAgICAgICBsZXQgcm93O1xyXG4gICAgICAgIGlmIChwb3NpdGlvbiA8IDExKSB7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IHBvc2l0aW9uIC0gMTtcclxuICAgICAgICAgICAgcm93ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09IDEwMCkge1xyXG4gICAgICAgICAgICByb3cgPSA5O1xyXG4gICAgICAgICAgICBjb2x1bW4gPSA5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChwb3NpdGlvbiAlIDEwID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJvdyA9IHBhcnNlSW50KHN0ci5zbGljZSgwLCAxKSk7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IDk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByb3cgPSBwYXJzZUludChzdHIuc2xpY2UoMCwgMSkpO1xyXG4gICAgICAgICAgICBjb2x1bW4gPSBwYXJzZUludChzdHIuc2xpY2UoMSwgMikpIC0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHN0clJvdyA9IHJvdy50b1N0cmluZygpO1xyXG4gICAgICAgIGxldCBzdHJDb2wgPSBjb2x1bW4udG9TdHJpbmcoKTtcclxuICAgICAgICBsZXQgbmV3UG9zaXRpb24gPSBzdHJSb3cgKyBzdHJDb2w7XHJcbiAgICAgICAgcmV0dXJuIG5ld1Bvc2l0aW9uO1xyXG4gICAgfVxyXG4gICAgZ2V0Q29sKHN0cikge1xyXG4gICAgICAgIHJldHVybiBwYXJzZUludChzdHIuc2xpY2UoMSwgMikpO1xyXG4gICAgfVxyXG4gICAgZ2V0Um93KHN0cikge1xyXG4gICAgICAgIHJldHVybiBwYXJzZUludChzdHIuc2xpY2UoMCwgMSkpO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IEdhbWVCb2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xyXG5leHBvcnQgY2xhc3MgUGxheWVyIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIG9wb25lbnQpIHtcclxuICAgICAgICB0aGlzLmdhbWVib2FyZCA9IG5ldyBHYW1lQm9hcmQoKTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuc2hvdHMgPSBbXTtcclxuICAgICAgICB0aGlzLm9wb25lbnQgPSBvcG9uZW50O1xyXG4gICAgfVxyXG4gICAgYXR0YWNrKHBvc2l0aW9uLCBvcG9uZW50KSB7XHJcbiAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gdGhpcy5nYW1lYm9hcmQuY29udmVydFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgICBsZXQgcm93ID0gdGhpcy5nYW1lYm9hcmQuZ2V0Um93KG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICBsZXQgY29sID0gdGhpcy5nYW1lYm9hcmQuZ2V0Q29sKG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICBpZiAoIXRoaXMuc2hvdHMuaW5jbHVkZXMocG9zaXRpb24pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdHMucHVzaChwb3NpdGlvbik7XHJcbiAgICAgICAgICAgIG9wb25lbnQuZ2FtZWJvYXJkLnJlY2lldmVBdHRhY2socm93LCBjb2wpO1xyXG4gICAgICAgICAgICBpZiAob3BvbmVudC5nYW1lYm9hcmQuaXNPdmVyKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZ2dcIilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJhbmRvbUF0dGFjayhvcHBvbmVudCkge1xyXG4gICAgICAgIGxldCB2YWxpZFNob3QgPSBmYWxzZTtcclxuICAgICAgICBsZXQgcG9zaXRpb247XHJcbiAgICAgICAgd2hpbGUgKCF2YWxpZFNob3QpIHtcclxuICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMTtcclxuICAgICAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gdGhpcy5nYW1lYm9hcmQuY29udmVydFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgbGV0IHJvdyA9IHRoaXMuZ2FtZWJvYXJkLmdldFJvdyhuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGxldCBjb2wgPSB0aGlzLmdhbWVib2FyZC5nZXRDb2wobmV3UG9zaXRpb24pO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2hvdHMuaW5jbHVkZXMocG9zaXRpb24pKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3RzLnB1c2gocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgb3Bwb25lbnQuZ2FtZWJvYXJkLnJlY2lldmVBdHRhY2socm93LCBjb2wpO1xyXG4gICAgICAgICAgICAgICAgdmFsaWRTaG90ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vIGxldCBzdHI6IHN0cmluZ1xyXG4gICAgICAgICAgICAgICAgLy8gc3RyID0gcm93LnRvU3RyaW5nKCkgKyBjb2wudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsImV4cG9ydCBjbGFzcyBTaGlwIHtcclxuICAgIGNvbnN0cnVjdG9yKGxlbmd0aCwgbmFtZSkge1xyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuaXNIaXQgPSBbXTtcclxuICAgICAgICB0aGlzLnN1bmsgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgfVxyXG4gICAgaGl0KHBvc2l0aW9uKSB7XHJcbiAgICAgICAgLy9wdXNoIHBvc2l0aW9uIHRvIGlzaGl0IGFycmF5XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSGl0LmluY2x1ZGVzKHBvc2l0aW9uKSAmJiB0aGlzLmlzSGl0Lmxlbmd0aCA8IHRoaXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNIaXQucHVzaChwb3NpdGlvbik7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzSGl0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlzU3VuaygpIHtcclxuICAgICAgICAvL2NoZWNrcyBlYWNoIHBvc2l0aW9uIG9mIHNoaXAgZm9yIGhpdHMgaWYgYWxsIGFyZSBoaXQgaXMgc3Vua1xyXG4gICAgICAgIGlmICh0aGlzLmlzSGl0Lmxlbmd0aCA9PT0gdGhpcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5zdW5rID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgcmVuZGVyR3JpZHMgZnJvbSBcIi4vcmVuZGVyR2FtZUJvYXJkc1wiO1xyXG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi8uLi9mYWN0b3JpZXMvcGxheWVyc1wiO1xyXG5pbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vLi4vZmFjdG9yaWVzL3NoaXBcIjtcclxubGV0IGh1bWFuID0gbmV3IFBsYXllcihcImh1bWFuXCIsIFwiY29tcHV0ZXJcIik7XHJcbmxldCBjb21wdXRlciA9IG5ldyBQbGF5ZXIoXCJjb21wdXRlclwiLCBcImh1bWFuXCIpO1xyXG5sZXQgaEJvYXJkID0gaHVtYW4uZ2FtZWJvYXJkLmJvYXJkO1xyXG5sZXQgY0JvYXJkID0gY29tcHV0ZXIuZ2FtZWJvYXJkLmJvYXJkO1xyXG5sZXQgaENhcnJpZXIgPSBuZXcgU2hpcCg1LCBcImNhcnJpZXJcIik7XHJcbmxldCBoRGVzdHJveWVyID0gbmV3IFNoaXAoNCwgXCJkZXN0cm95ZXJcIik7XHJcbmxldCBoU3VibWFyaW5lID0gbmV3IFNoaXAoMywgXCJzdWJtYXJpbmVcIik7XHJcbmxldCBoUGF0cm9sID0gbmV3IFNoaXAoMiwgXCJwYXRyb2xcIik7XHJcbmxldCBjQ2FycmllciA9IG5ldyBTaGlwKDUsIFwiY2FycmllclwiKTtcclxubGV0IGNEZXN0cm95ZXIgPSBuZXcgU2hpcCg0LCBcImRlc3Ryb3llclwiKTtcclxubGV0IGNTdWJtYXJpbmUgPSBuZXcgU2hpcCgzLCBcInN1Ym1hcmluZVwiKTtcclxubGV0IGNQYXRyb2wgPSBuZXcgU2hpcCgyLCBcInBhdHJvbFwiKTtcclxuY29uc3QgaHVtYW5TaGlwcyA9IFtoQ2FycmllciwgaERlc3Ryb3llciwgaFN1Ym1hcmluZSwgaFBhdHJvbF07XHJcbmNvbnN0IGNvbXB1dGVyU2hpcHMgPSBbY0NhcnJpZXIsIGNEZXN0cm95ZXIsIGNTdWJtYXJpbmUsIGNQYXRyb2xdO1xyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwbGFjZVNoaXAocGxheWVyTmFtZSkge1xyXG4gICAgY29uc3QgbWFudWFsbHlQbGFjZWRTaGlwcyA9IFtdO1xyXG4gICAgbGV0IHBvc2l0aW9uO1xyXG4gICAgY29uc3QgaW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW5mb1wiKTtcclxuICAgIGluZm8gPT09IG51bGwgfHwgaW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5mby5jbGFzc0xpc3QucmVtb3ZlKFwiaW5mb1wiKTtcclxuICAgIGluZm8gPT09IG51bGwgfHwgaW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5mby5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcclxuICAgIGNvbnN0IHBsYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZVwiKTtcclxuICAgIHBsYWNlID09PSBudWxsIHx8IHBsYWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwbGFjZS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcclxuICAgIGNvbnN0IGdyaWQxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkLWNvbnRhaW5lclwiKTtcclxuICAgIGNvbnN0IHRpdGxlMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGl0bGUtMVwiKTtcclxuICAgIHRpdGxlMS50ZXh0Q29udGVudCA9IHBsYXllck5hbWU7XHJcbiAgICBjb25zdCBzaGlwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcHNcIik7XHJcbiAgICBjb25zdCByb3RhdGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJvdGF0ZVwiKTtcclxuICAgIGNvbnN0IGNhcnJpZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcnJpZXJcIik7XHJcbiAgICBjb25zdCBkZXN0cm95ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRlc3Ryb3llclwiKTtcclxuICAgIGNvbnN0IHN1Ym1hcmluZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3VibWFyaW5lXCIpO1xyXG4gICAgY29uc3QgcGF0cm9sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wYXRyb2xcIik7XHJcbiAgICByb3RhdGVCdXR0b24gPT09IG51bGwgfHwgcm90YXRlQnV0dG9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiByb3RhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoY2FycmllciA9PT0gbnVsbCB8fCBjYXJyaWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjYXJyaWVyLmNsYXNzTGlzdC5jb250YWlucyhcInJvdGF0ZWRcIikpIHtcclxuICAgICAgICAgICAgc2hpcHMgPT09IG51bGwgfHwgc2hpcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNoaXBzLmNsYXNzTGlzdC5yZW1vdmUoXCJzaGlwcy1ob3Jpem9udGFsXCIpO1xyXG4gICAgICAgICAgICBzaGlwcyA9PT0gbnVsbCB8fCBzaGlwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2hpcHMuY2xhc3NMaXN0LmFkZChcInNoaXBzLXZlcnRpY2FsXCIpO1xyXG4gICAgICAgICAgICBjYXJyaWVyLmNsYXNzTGlzdC5yZW1vdmUoXCJyb3RhdGVkXCIpO1xyXG4gICAgICAgICAgICBkZXN0cm95ZXIgPT09IG51bGwgfHwgZGVzdHJveWVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXN0cm95ZXIuY2xhc3NMaXN0LnJlbW92ZShcInJvdGF0ZWRcIik7XHJcbiAgICAgICAgICAgIHN1Ym1hcmluZSA9PT0gbnVsbCB8fCBzdWJtYXJpbmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1Ym1hcmluZS5jbGFzc0xpc3QucmVtb3ZlKFwicm90YXRlZFwiKTtcclxuICAgICAgICAgICAgcGF0cm9sID09PSBudWxsIHx8IHBhdHJvbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGF0cm9sLmNsYXNzTGlzdC5yZW1vdmUoXCJyb3RhdGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc2hpcHMgPT09IG51bGwgfHwgc2hpcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNoaXBzLmNsYXNzTGlzdC5yZW1vdmUoXCJzaGlwcy12ZXJ0aWNhbFwiKTtcclxuICAgICAgICAgICAgc2hpcHMgPT09IG51bGwgfHwgc2hpcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNoaXBzLmNsYXNzTGlzdC5hZGQoXCJzaGlwcy1ob3Jpem9udGFsXCIpO1xyXG4gICAgICAgICAgICBjYXJyaWVyID09PSBudWxsIHx8IGNhcnJpZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNhcnJpZXIuY2xhc3NMaXN0LmFkZChcInJvdGF0ZWRcIik7XHJcbiAgICAgICAgICAgIGRlc3Ryb3llciA9PT0gbnVsbCB8fCBkZXN0cm95ZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlc3Ryb3llci5jbGFzc0xpc3QuYWRkKFwicm90YXRlZFwiKTtcclxuICAgICAgICAgICAgc3VibWFyaW5lID09PSBudWxsIHx8IHN1Ym1hcmluZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3VibWFyaW5lLmNsYXNzTGlzdC5hZGQoXCJyb3RhdGVkXCIpO1xyXG4gICAgICAgICAgICBwYXRyb2wgPT09IG51bGwgfHwgcGF0cm9sID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXRyb2wuY2xhc3NMaXN0LmFkZChcInJvdGF0ZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3RhcnQtZ2FtZVwiKTtcclxuICAgIHN0YXJ0QnV0dG9uID09PSBudWxsIHx8IHN0YXJ0QnV0dG9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIGdyaWQxLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxyXG4gICAgICAgIHBsYWNlLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgcmVuZGVyR3JpZHMocGxheWVyTmFtZSk7XHJcbiAgICB9KTtcclxuICAgIGxldCBjb3VudCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhCb2FyZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaEJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiZGF0YS1ocG9zaXRpb25cIiwgY291bnQpO1xyXG4gICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKFwiZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgICAgICBncmlkMSA9PT0gbnVsbCB8fCBncmlkMSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHJhbmRvbWx5UGxhY2UgPSAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYW5kb21seS1wbGFjZVwiKSk7XHJcbiAgICByYW5kb21seVBsYWNlID09PSBudWxsIHx8IHJhbmRvbWx5UGxhY2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJhbmRvbWx5UGxhY2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBodW1hblNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcclxuICAgICAgICAgICAgaHVtYW4uZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByYW5kb21seVBsYWNlLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICBncmlkMS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIGNoZWNrQm9hcmQoKTtcclxuICAgIH0pO1xyXG4gICAgZnVuY3Rpb24gY2hlY2tCb2FyZCgpIHtcclxuICAgICAgICBncmlkMS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaEJvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaEJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiaHBvc2l0aW9uXCIsIGNvdW50KTtcclxuICAgICAgICAgICAgICAgIC8vIGdyaWRJdGVtLnRleHRDb250ZW50ID0gYm9hcmRbaV1bal1cclxuICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihoQm9hcmRbaV1bal0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZChcInNoaXAtaGVyZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoXCJncmlkLWl0ZW1cIik7XHJcbiAgICAgICAgICAgICAgICBncmlkMSA9PT0gbnVsbCB8fCBncmlkMSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gZnVuY3Rpb24gY2hlY2tCb2FyZCgpe1xyXG4gICAgLy8gICAgIGNvbnN0IGdyaWRJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncmlkLWl0ZW0nKVxyXG4gICAgLy8gICAgIGdyaWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgLy8gICAgICAgICBpZihpdGVtLilcclxuICAgIC8vICAgICB9KVxyXG4gICAgLy8gfVxyXG4gICAgZXZlbnRzKCk7XHJcbiAgICBmdW5jdGlvbiBldmVudHMoKSB7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZHJhZ2dhYmxlXCIpO1xyXG4gICAgICAgIGRyYWdnYWJsZXMuZm9yRWFjaCgoZHJhZ2dhYmxlKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGRyYWdnYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwiZHJhZyBzdGFydFwiKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgIGRyYWdnYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2LnRhcmdldClcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBFbGVtZW50ID0gZXYudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocG9zaXRpb24pXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UG9zID0gcGFyc2VJbnQocG9zaXRpb24uZGF0YXNldC5ocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY3VycmVudFBvcylcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHNoaXAuaWQpXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzaGlwTmFtZSA9IHNoaXBFbGVtZW50LmlkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IFtzaGlwTmFtZSwgY3VycmVudFBvc107XHJcbiAgICAgICAgICAgICAgICBtYW51YWxseVBsYWNlZFNoaXBzLnB1c2goY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICAvLyBwbGFjZVNoaXBEcmFnZ2VkKGN1cnJlbnRQb3MsIHNoaXBOYW1lKVxyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coaEJvYXJkKVxyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobWFudWFsbHlQbGFjZWRTaGlwcylcclxuICAgICAgICAgICAgICAgIC8vIHBsYWNlU2hpcERyYWdnZWQoY3VycmVudFBvcywgc2hpcE5hbWUpXHJcbiAgICAgICAgICAgICAgICBjaGVja1BsYWNlZChtYW51YWxseVBsYWNlZFNoaXBzKTtcclxuICAgICAgICAgICAgICAgIC8vIGdyaWQxLmlubmVySFRNTCA9ICcnXHJcbiAgICAgICAgICAgICAgICAvLyBjaGVja0JvYXJkKClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdyaWQtaXRlbVwiKTtcclxuICAgICAgICBncmlkSXRlbS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBlLnRhcmdldDtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHBvc2l0aW9uKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHBsYWNlU2hpcERyYWdnZWQocG9zaXRpb24sIG5hbWUpIHtcclxuICAgICAgICBpZiAobmFtZSA9PT0gXCJjYXJyaWVyXCIpIHtcclxuICAgICAgICAgICAgaWYgKGNhcnJpZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwicm90YXRlZFwiKSkge1xyXG4gICAgICAgICAgICAgICAgaHVtYW4uZ2FtZWJvYXJkLnBsYWNlU2hpcChoQ2FycmllciwgcG9zaXRpb24sIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGh1bWFuLmdhbWVib2FyZC5wbGFjZVNoaXAoaENhcnJpZXIsIHBvc2l0aW9uLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmFtZSA9PT0gXCJkZXN0cm95ZXJcIikge1xyXG4gICAgICAgICAgICBpZiAoY2Fycmllci5jbGFzc0xpc3QuY29udGFpbnMoXCJyb3RhdGVkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhEZXN0cm95ZXIsIHBvc2l0aW9uLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhEZXN0cm95ZXIsIHBvc2l0aW9uLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmFtZSA9PT0gXCJzdWJtYXJpbmVcIikge1xyXG4gICAgICAgICAgICBpZiAoY2Fycmllci5jbGFzc0xpc3QuY29udGFpbnMoXCJyb3RhdGVkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhTdWJtYXJpbmUsIHBvc2l0aW9uLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhTdWJtYXJpbmUsIHBvc2l0aW9uLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmFtZSA9PT0gXCJwYXRyb2xcIikge1xyXG4gICAgICAgICAgICBpZiAoY2Fycmllci5jbGFzc0xpc3QuY29udGFpbnMoXCJyb3RhdGVkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhQYXRyb2wsIHBvc2l0aW9uLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VTaGlwKGhQYXRyb2wsIHBvc2l0aW9uLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjaGVja0JvYXJkKCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjaGVja1BsYWNlZChhcnIpIHtcclxuICAgICAgICBpZiAoYXJyLmxlbmd0aCA9PT0gNCkge1xyXG4gICAgICAgICAgICBhcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcGxhY2VTaGlwRHJhZ2dlZChpdGVtWzFdLCBpdGVtWzBdKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGhCb2FyZCk7XHJcbiAgICAgICAgICAgIGdyaWQxLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGNoZWNrQm9hcmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IHsgaHVtYW5TaGlwcywgY29tcHV0ZXJTaGlwcywgaHVtYW4sIGNvbXB1dGVyLCBoQm9hcmQsIGNCb2FyZCB9O1xyXG4iLCJpbXBvcnQgeyBjb21wdXRlclNoaXBzLCBodW1hbiwgY29tcHV0ZXIsIGhCb2FyZCwgY0JvYXJkIH0gZnJvbSBcIi4uL3VpL3BsYWNlU2hpcFwiO1xyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZW5kZXJHcmlkcyhwbGF5ZXJOYW1lKSB7XHJcbiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XHJcbiAgICAvLyBjb25zdCBpbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbmZvXCIpO1xyXG4gICAgLy8gaW5mbz8uY2xhc3NMaXN0LnJlbW92ZShcImluZm9cIik7XHJcbiAgICAvLyBpbmZvPy5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcclxuICAgIGNvbnN0IHBsYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYWNlJyk7XHJcbiAgICBwbGFjZSA9PT0gbnVsbCB8fCBwbGFjZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGxhY2UuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xyXG4gICAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFpblwiKTtcclxuICAgIG1haW4uY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIik7XHJcbiAgICBtYWluLmNsYXNzTGlzdC5hZGQoXCJtYWluXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGVudFwiKTtcclxuICAgIGNvbnN0IGdyaWRDb250YWluZXIxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkMVwiKTtcclxuICAgIGNvbnN0IGdyaWQxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkLWNvbnRhaW5lcjFcIik7XHJcbiAgICBjb25zdCB0aXRsZTEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRpdGxlLTFcIik7XHJcbiAgICB0aXRsZTEudGV4dENvbnRlbnQgPSBwbGF5ZXJOYW1lO1xyXG4gICAgY29uc3Qgc3Vua2VuMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3Vua2VuMVwiKTtcclxuICAgIGNvbnN0IGdyaWRDb250YWluZXIyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkMlwiKTtcclxuICAgIGNvbnN0IGdyaWQyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ncmlkLWNvbnRhaW5lcjJcIik7XHJcbiAgICBjb25zdCB0aXRsZTIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRpdGxlLTJcIik7XHJcbiAgICB0aXRsZTIudGV4dENvbnRlbnQgPSBcIkNvbXB1dGVyXCI7XHJcbiAgICBjb25zdCBzdW5rZW4yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zdW5rZW4yXCIpO1xyXG4gICAgY29uc3Qgd2hvV29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53aG8td29uXCIpO1xyXG4gICAgY29uc3QgcmVzdGFydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICByZXN0YXJ0LmNsYXNzTGlzdC5hZGQoXCJyZXN0YXJ0XCIpO1xyXG4gICAgcmVzdGFydC50ZXh0Q29udGVudCA9IFwiUmVzdGFydFwiO1xyXG4gICAgcmVzdGFydC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgfSk7XHJcbiAgICAvLyBsZXQgaHVtYW4gPSBuZXcgUGxheWVyKFwiaHVtYW5cIiwgXCJjb21wdXRlclwiKTtcclxuICAgIC8vIGxldCBjb21wdXRlciA9IG5ldyBQbGF5ZXIoXCJjb21wdXRlclwiLCBcImh1bWFuXCIpO1xyXG4gICAgLy8gbGV0IGhCb2FyZCA9IGh1bWFuLmdhbWVib2FyZC5ib2FyZDtcclxuICAgIC8vIGxldCBjQm9hcmQgPSBjb21wdXRlci5nYW1lYm9hcmQuYm9hcmQ7XHJcbiAgICAvLyBsZXQgaENhcnJpZXIgPSBuZXcgU2hpcCg1LCBcImNhcnJpZXJcIik7XHJcbiAgICAvLyBsZXQgaERlc3Ryb3llciA9IG5ldyBTaGlwKDQsIFwiZGVzdHJveWVyXCIpO1xyXG4gICAgLy8gbGV0IGhTdWJtYXJpbmUgPSBuZXcgU2hpcCgzLCBcInN1Ym1hcmluZVwiKTtcclxuICAgIC8vIGxldCBoUGF0cm9sID0gbmV3IFNoaXAoMiwgXCJwYXRyb2xcIik7XHJcbiAgICAvLyBsZXQgY0NhcnJpZXIgPSBuZXcgU2hpcCg1LCBcImNhcnJpZXJcIik7XHJcbiAgICAvLyBsZXQgY0Rlc3Ryb3llciA9IG5ldyBTaGlwKDQsIFwiZGVzdHJveWVyXCIpO1xyXG4gICAgLy8gbGV0IGNTdWJtYXJpbmUgPSBuZXcgU2hpcCgzLCBcInN1Ym1hcmluZVwiKTtcclxuICAgIC8vIGxldCBjUGF0cm9sID0gbmV3IFNoaXAoMiwgXCJwYXRyb2xcIik7XHJcbiAgICAvLyBjb25zdCBodW1hblNoaXBzID0gW2hDYXJyaWVyLCBoRGVzdHJveWVyLCBoU3VibWFyaW5lLCBoUGF0cm9sXTtcclxuICAgIC8vIGNvbnN0IGNvbXB1dGVyU2hpcHMgPSBbY0NhcnJpZXIsIGNEZXN0cm95ZXIsIGNTdWJtYXJpbmUsIGNQYXRyb2xdO1xyXG4gICAgLy8gYWxsU2hpcHMuZm9yRWFjaChzaGlwID0+IHtcclxuICAgIC8vICAgICBjb21wdXRlci5nYW1lYm9hcmQucmFuZG9tbHlQbGFjZVNoaXBzKHNoaXApO1xyXG4gICAgLy8gICAgIGh1bWFuLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICAvLyB9KVxyXG4gICAgY29tcHV0ZXJTaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XHJcbiAgICAgICAgY29tcHV0ZXIuZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgIH0pO1xyXG4gICAgLy8gaHVtYW5TaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XHJcbiAgICAvLyAgIGh1bWFuLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICAvLyB9KTtcclxuICAgIGxldCBjb3VudCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhCb2FyZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaEJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiaHBvc2l0aW9uXCIsIGNvdW50KTtcclxuICAgICAgICAgICAgLy8gZ3JpZEl0ZW0udGV4dENvbnRlbnQgPSBib2FyZFtpXVtqXVxyXG4gICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoaEJvYXJkW2ldW2pdKSkge1xyXG4gICAgICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZChcInNoaXAtaGVyZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKFwiZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgICAgICBncmlkMSA9PT0gbnVsbCB8fCBncmlkMSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY0JvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjQm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBncmlkSXRlbS5zZXRBdHRyaWJ1dGUoXCJjcG9zaXRpb25cIiwgY0JvYXJkW2ldW2pdKTtcclxuICAgICAgICAgICAgLy8gZ3JpZEl0ZW0udGV4dENvbnRlbnQgPSBib2FyZFtpXVtqXVxyXG4gICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKFwiZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKFwiYWktZ3JpZFwiKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChncmlkSXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJoaXRcIikgfHxcclxuICAgICAgICAgICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJtaXNzXCIpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgaHVtYW4uZ2FtZWJvYXJkLmlzT3ZlcigpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZXIuZ2FtZWJvYXJkLmlzT3ZlcigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGNCb2FyZFtpXVtqXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBncmlkSXRlbS5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpc1N1bmsgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlci5nYW1lYm9hcmQucmVjaWV2ZUF0dGFjayhpLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlci5nYW1lYm9hcmQucGxhY2VkU2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hpcC5uYW1lID09PSBjQm9hcmRbaV1bal0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VuayA9IHNoaXAuc3VuaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N1bmspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Vua2VuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW5rZW4udGV4dENvbnRlbnQgPSBjQm9hcmRbaV1bal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bmtlbjIgPT09IG51bGwgfHwgc3Vua2VuMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc3Vua2VuMi5hcHBlbmRDaGlsZChzdW5rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tcHV0ZXIuZ2FtZWJvYXJkLmlzT3ZlcigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3aW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5uZXIudGV4dENvbnRlbnQgPSBcIldpbm5lcjogXCIgKyBwbGF5ZXJOYW1lICsgXCIhXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aG9Xb24gPT09IG51bGwgfHwgd2hvV29uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aG9Xb24uYXBwZW5kQ2hpbGQod2lubmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdob1dvbiA9PT0gbnVsbCB8fCB3aG9Xb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHdob1dvbi5hcHBlbmRDaGlsZChyZXN0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IHBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBjb21wdXRlci5yYW5kb21BdHRhY2soaHVtYW4pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtocG9zaXRpb249XCIke3Bvc2l0aW9ufVwiXWApO1xyXG4gICAgICAgICAgICAgICAgbGV0IHRlbXAgPSBwb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIGxldCBuZXdQb3NpdGlvbiA9IGh1bWFuLmdhbWVib2FyZC5jb252ZXJ0UG9zaXRpb24odGVtcCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcm93ID0gaHVtYW4uZ2FtZWJvYXJkLmdldFJvdyhuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29sID0gaHVtYW4uZ2FtZWJvYXJkLmdldENvbChuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoaHVtYW4uZ2FtZWJvYXJkLmJvYXJkW3Jvd11bY29sXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnc2hpcC1oZXJlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlzU3VuazEgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucmVjaWV2ZUF0dGFjayhpLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICBodW1hbi5nYW1lYm9hcmQucGxhY2VkU2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hpcC5uYW1lID09PSBoQm9hcmRbcm93XVtjb2xdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N1bmsxID0gc2hpcC5zdW5rO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3VuazEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Vua2VuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW5rZW4udGV4dENvbnRlbnQgPSBoQm9hcmRbcm93XVtjb2xdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW5rZW4xID09PSBudWxsIHx8IHN1bmtlbjEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1bmtlbjEuYXBwZW5kQ2hpbGQoc3Vua2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGh1bWFuLmdhbWVib2FyZC5pc092ZXIoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lubmVyLnRleHRDb250ZW50ID0gXCJXaW5uZXI6IENvbXB1dGVyIVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hvV29uID09PSBudWxsIHx8IHdob1dvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2hvV29uLmFwcGVuZENoaWxkKHdpbm5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aG9Xb24gPT09IG51bGwgfHwgd2hvV29uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aG9Xb24uYXBwZW5kQ2hpbGQocmVzdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID09PSBudWxsIHx8IGl0ZW0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGl0ZW0uY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBncmlkMiA9PT0gbnVsbCB8fCBncmlkMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDIuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgcGxhY2VTaGlwIGZyb20gXCIuL3BsYWNlU2hpcFwiO1xyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdGFydEdhbWUoKSB7XHJcbiAgICBjb25zdCBpbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbmZvXCIpO1xyXG4gICAgY29uc3QgaW5wdXRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgaW5wdXRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImlucHV0LWNvbnRhaW5lclwiKTtcclxuICAgIGNvbnN0IG5hbWVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKTtcclxuICAgIG5hbWVMYWJlbC50ZXh0Q29udGVudCA9IFwiRW50ZXIgTmFtZTpcIjtcclxuICAgIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgIG5hbWVJbnB1dC5jbGFzc0xpc3QuYWRkKFwibmFtZS1pbnB1dFwiKTtcclxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgIHN0YXJ0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJzdGFydC1idXR0b25cIik7XHJcbiAgICBzdGFydEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnRcIjtcclxuICAgIGlucHV0Q29udGFpbmVyLmFwcGVuZENoaWxkKG5hbWVMYWJlbCk7XHJcbiAgICBpbnB1dENvbnRhaW5lci5hcHBlbmRDaGlsZChuYW1lSW5wdXQpO1xyXG4gICAgaW5wdXRDb250YWluZXIuYXBwZW5kQ2hpbGQoc3RhcnRCdXR0b24pO1xyXG4gICAgaW5mbyA9PT0gbnVsbCB8fCBpbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbmZvLmFwcGVuZENoaWxkKGlucHV0Q29udGFpbmVyKTtcclxuICAgIHN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKG5hbWVJbnB1dC52YWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gbmFtZUlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICBpbmZvID09PSBudWxsIHx8IGluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluZm8ucmVtb3ZlQ2hpbGQoaW5wdXRDb250YWluZXIpO1xyXG4gICAgICAgICAgICBwbGFjZVNoaXAobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gXCJUbyBsYXp5IHRvIGVudGVyIGEgbmFtZVwiO1xyXG4gICAgICAgICAgICBpbmZvID09PSBudWxsIHx8IGluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluZm8ucmVtb3ZlQ2hpbGQoaW5wdXRDb250YWluZXIpO1xyXG4gICAgICAgICAgICBwbGFjZVNoaXAobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuIiwiaW1wb3J0IHN0YXJ0R2FtZSBmcm9tIFwiLi91aS9zdGFydEdhbWVcIjtcclxuc3RhcnRHYW1lKCk7XHJcbi8vIHJlbmRlckdyaWRzKCdqamNyYXp5bWFuJylcclxuIl0sIm5hbWVzIjpbIkdhbWVCb2FyZCIsImNvbnN0cnVjdG9yIiwidGhpcyIsImJvYXJkIiwiY3JlYXRlQm9hcmQiLCJoaXRzIiwibWlzc2VzIiwicGxhY2VkU2hpcHMiLCJnYW1lT3ZlciIsInN1bmtTaGlwcyIsImNvdW50IiwiaSIsImoiLCJwbGFjZVNoaXAiLCJzaGlwIiwic3RhcnQiLCJ2ZXJ0aWNhbCIsInZhbGlkUGxhY2VtZW50IiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJpbmRleCIsImluZGV4T2YiLCJuYW1lIiwicHVzaCIsInJlY2lldmVBdHRhY2siLCJyb3ciLCJjb2x1bW4iLCJwb3NpdGlvbiIsIk51bWJlciIsImlzSW50ZWdlciIsImZvckVhY2giLCJoaXQiLCJpc1N1bmsiLCJpc092ZXIiLCJpc1ZlcnRpY2FsIiwibmV3UG9zaXRpb24iLCJjb252ZXJ0UG9zaXRpb24iLCJnZXRSb3ciLCJnZXRDb2wiLCJyYW5kb21seVBsYWNlU2hpcHMiLCJkaXJlY3Rpb24iLCJ2YWxpZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInN0ciIsInRvU3RyaW5nIiwicGFyc2VJbnQiLCJzbGljZSIsIlBsYXllciIsIm9wb25lbnQiLCJnYW1lYm9hcmQiLCJzaG90cyIsImF0dGFjayIsImNvbCIsInJhbmRvbUF0dGFjayIsIm9wcG9uZW50IiwidmFsaWRTaG90IiwiU2hpcCIsImlzSGl0Iiwic3VuayIsImh1bWFuIiwiY29tcHV0ZXIiLCJoQm9hcmQiLCJjQm9hcmQiLCJoQ2FycmllciIsImhEZXN0cm95ZXIiLCJoU3VibWFyaW5lIiwiaFBhdHJvbCIsImNDYXJyaWVyIiwiY0Rlc3Ryb3llciIsImNTdWJtYXJpbmUiLCJjUGF0cm9sIiwiaHVtYW5TaGlwcyIsImNvbXB1dGVyU2hpcHMiLCJwbGF5ZXJOYW1lIiwibWFudWFsbHlQbGFjZWRTaGlwcyIsImluZm8iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJwbGFjZSIsImdyaWQxIiwidGV4dENvbnRlbnQiLCJzaGlwcyIsInJvdGF0ZUJ1dHRvbiIsImNhcnJpZXIiLCJkZXN0cm95ZXIiLCJzdWJtYXJpbmUiLCJwYXRyb2wiLCJhZGRFdmVudExpc3RlbmVyIiwiY29udGFpbnMiLCJzdGFydEJ1dHRvbiIsImlubmVySFRNTCIsIm1haW4iLCJzdW5rZW4xIiwiZ3JpZDIiLCJzdW5rZW4yIiwid2hvV29uIiwicmVzdGFydCIsImNyZWF0ZUVsZW1lbnQiLCJsb2NhdGlvbiIsInJlbG9hZCIsImdyaWRJdGVtIiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJzdW5rZW4iLCJ3aW5uZXIiLCJpdGVtIiwidGVtcCIsImlzU3VuazEiLCJyZW5kZXJHcmlkcyIsInJhbmRvbWx5UGxhY2UiLCJjaGVja0JvYXJkIiwiZGlzYWJsZWQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZHJhZ2dhYmxlIiwiZXYiLCJzaGlwRWxlbWVudCIsInRhcmdldCIsImN1cnJlbnRQb3MiLCJkYXRhc2V0IiwiaHBvc2l0aW9uIiwiY3VycmVudCIsImlkIiwiYXJyIiwicGxhY2VTaGlwRHJhZ2dlZCIsImNvbnNvbGUiLCJsb2ciLCJlIiwiaW5wdXRDb250YWluZXIiLCJuYW1lTGFiZWwiLCJuYW1lSW5wdXQiLCJ2YWx1ZSIsInJlbW92ZUNoaWxkIiwic3RhcnRHYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==