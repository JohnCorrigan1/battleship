(()=>{"use strict";class t{constructor(){this.board=[],this.createBoard(),this.hits=[],this.misses=[],this.placedShips=[],this.gameOver=!1,this.sunkShips=[]}createBoard(){let t=0;for(let e=0;e<10;e++){this.board[e]=[];for(let s=0;s<10;s++)t++,this.board[e][s]=t}}placeShip(t,e,s){if(s&&!0===this.validPlacement(e,t.length,!0)){for(let s=0;s<t.length;s++){for(let s=0;s<this.board.length;s++)if(this.board[s].includes(e)){let i=this.board[s].indexOf(e);this.board[s][i]=t.name}e+=10}this.placedShips.push(t)}else if(!s&&!0===this.validPlacement(e,t.length,!1)){for(let s=0;s<t.length;s++){for(let s=0;s<this.board.length;s++)if(this.board[s].includes(e)){let i=this.board[s].indexOf(e);this.board[s][i]=t.name}e+=1}this.placedShips.push(t)}}recieveAttack(t,e){let s=t+e;Number.isInteger(this.board[t][e])?this.misses.push(s):(this.hits.push(s),this.placedShips.forEach((i=>{if(i.name===this.board[t][e])return i.hit(s),i.isSunk(),void(i.isSunk()&&this.sunkShips.push(i))})))}isOver(){return 4===this.sunkShips.length}validPlacement(t,e,s){let i=this.convertPosition(t),r=this.getRow(i),n=this.getCol(i);if(s&&r+e>10)return!1;if(!s&&n+e>10)return!1;if(s)for(let t=0;t<e;t++){if(!Number.isInteger(this.board[r][n]))return!1;r++}else for(let t=0;t<e;t++){if(!Number.isInteger(this.board[r][n]))return!1;n++}return!0}randomlyPlaceShips(t){let e,s,i=!1;for(;!i;)e=Math.floor(100*Math.random())+1,s=Math.random()<.5,this.validPlacement(e,t.length,s)?(i=!0,this.placeShip(t,e,s)):i=!1}convertPosition(t){let e,s,i=t.toString();return t<11?(e=t-1,s=0):100===t?(s=9,e=9):(s=parseInt(i.slice(0,1)),e=parseInt(i.slice(1,2))-1),s.toString()+e.toString()}getCol(t){return parseInt(t.slice(1,2))}getRow(t){return parseInt(t.slice(0,1))}}class e{constructor(e,s){this.gameboard=new t,this.name=e,this.shots=[],this.oponent=s}attack(t,e){let s=this.gameboard.convertPosition(t),i=this.gameboard.getRow(s),r=this.gameboard.getCol(s);this.shots.includes(t)||(this.shots.push(t),e.gameboard.recieveAttack(i,r),e.gameboard.isOver())}randomAttack(t){let e,s=!1;for(;!s;){e=Math.floor(100*Math.random())+1;let i=this.gameboard.convertPosition(e),r=this.gameboard.getRow(i),n=this.gameboard.getCol(i);if(!this.shots.includes(e)){let i;return console.log(e),this.shots.push(e),t.gameboard.recieveAttack(r,n),s=!0,i=r.toString()+n.toString(),i}}}}class s{constructor(t,e){this.length=t,this.isHit=[],this.sunk=!1,this.name=e}hit(t){if(!this.isHit.includes(t)&&this.isHit.length<this.length)return this.isHit.push(t),this.isHit}isSunk(){return this.isHit.length===this.length&&(this.sunk=!0,!0)}}!function(t){document.querySelector("body");const i=document.querySelector(".grid-container1");document.querySelector(".title-1").textContent="jjcrazyman",document.querySelector(".sunken1");const r=document.querySelector(".grid-container2");document.querySelector(".title-2").textContent="Computer";const n=document.querySelector(".sunken2");let o=new e("human","computer"),a=new e("computer","human"),l=o.gameboard.board,h=a.gameboard.board;const d=[new s(5,"carrier"),new s(4,"destroyer"),new s(3,"submarine"),new s(2,"patrol")];[new s(5,"carrier"),new s(4,"destroyer"),new s(3,"submarine"),new s(2,"patrol")].forEach((t=>{a.gameboard.randomlyPlaceShips(t)})),d.forEach((t=>{o.gameboard.randomlyPlaceShips(t)}));for(let t=0;t<l.length;t++)for(let e=0;e<l[t].length;e++){const s=document.createElement("div");s.setAttribute("hposition",l[t][e]),Number.isInteger(l[t][e])||s.classList.add("ship-here"),s.classList.add("grid-item"),null==i||i.appendChild(s)}for(let t=0;t<h.length;t++)for(let e=0;e<h[t].length;e++){const s=document.createElement("div");s.setAttribute("cposition",h[t][e]),s.classList.add("grid-item"),s.classList.add("ai-grid"),s.addEventListener("click",(function(){if(Number.isInteger(h[t][e]))s.classList.add("miss");else{s.classList.add("hit");let i=!1;if(a.gameboard.recieveAttack(t,e),a.gameboard.placedShips.forEach((s=>{s.name===h[t][e]&&(i=s.sunk)})),i){const s=document.createElement("h2");s.textContent=h[t][e],null==n||n.appendChild(s),a.gameboard.isOver()&&alert("You win")}}let i;i=a.randomAttack(o);let r=o.gameboard.getRow(i),d=o.gameboard.getCol(i);const c=document.querySelector(`[hposition="${i}"]`);Number.isInteger(l[r][d])?null==c||c.classList.add("miss"):null==c||c.classList.add("hit")})),null==r||r.appendChild(s)}document.querySelectorAll(".grid-item")}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cC8uL3NyYy9mYWN0b3JpZXMvZ2FtZWJvYXJkLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL3BsYXllcnMudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvc2hpcC50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VpL3JlbmRlckdhbWVCb2FyZHMudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgeyBTaGlwIH0gZnJvbSAnLi9zaGlwJ1xyXG5leHBvcnQgY2xhc3MgR2FtZUJvYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuYm9hcmQgPSBbXTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICAgICAgdGhpcy5oaXRzID0gW107XHJcbiAgICAgICAgdGhpcy5taXNzZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnBsYWNlZFNoaXBzID0gW107XHJcbiAgICAgICAgdGhpcy5nYW1lT3ZlciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc3Vua1NoaXBzID0gW107XHJcbiAgICB9XHJcbiAgICBjcmVhdGVCb2FyZCgpIHtcclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmJvYXJkW2ldID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbaV1bal0gPSBjb3VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHBsYWNlU2hpcChzaGlwLCBzdGFydCwgdmVydGljYWwpIHtcclxuICAgICAgICBpZiAodmVydGljYWwgJiYgdGhpcy52YWxpZFBsYWNlbWVudChzdGFydCwgc2hpcC5sZW5ndGgsIHRydWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmJvYXJkLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRbal0uaW5jbHVkZXMoc3RhcnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuYm9hcmRbal0uaW5kZXhPZihzdGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbal1baW5kZXhdID0gc2hpcC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN0YXJ0ICs9IDEwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGxhY2VkU2hpcHMucHVzaChzaGlwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXZlcnRpY2FsICYmXHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRQbGFjZW1lbnQoc3RhcnQsIHNoaXAubGVuZ3RoLCBmYWxzZSkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYm9hcmQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2FyZFtqXS5pbmNsdWRlcyhzdGFydCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5ib2FyZFtqXS5pbmRleE9mKHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2FyZFtqXVtpbmRleF0gPSBzaGlwLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3RhcnQgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVjaWV2ZUF0dGFjayhyb3csIGNvbHVtbikge1xyXG4gICAgICAgIGxldCBwb3NpdGlvbiA9IHJvdyArIGNvbHVtbjtcclxuICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGl0cy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5wbGFjZWRTaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hpcC5uYW1lID09PSB0aGlzLmJvYXJkW3Jvd11bY29sdW1uXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNoaXAuaGl0KHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwLmlzU3VuaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vua1NoaXBzLnB1c2goc2hpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1pc3Nlcy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlzT3ZlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5zdW5rU2hpcHMubGVuZ3RoID09PSA0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB2YWxpZFBsYWNlbWVudChwb3NpdGlvbiwgbGVuZ3RoLCBpc1ZlcnRpY2FsKSB7XHJcbiAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gdGhpcy5jb252ZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgICAgIGxldCByb3cgPSB0aGlzLmdldFJvdyhuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgbGV0IGNvbHVtbiA9IHRoaXMuZ2V0Q29sKG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICBpZiAoaXNWZXJ0aWNhbCAmJiByb3cgKyBsZW5ndGggPiAxMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCFpc1ZlcnRpY2FsICYmIGNvbHVtbiArIGxlbmd0aCA+IDEwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHRoaXMuYm9hcmRbcm93XVtjb2x1bW5dKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByYW5kb21seVBsYWNlU2hpcHMoc2hpcCkge1xyXG4gICAgICAgIGxldCB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBwb3NpdGlvbjtcclxuICAgICAgICBsZXQgZGlyZWN0aW9uO1xyXG4gICAgICAgIHdoaWxlICghdmFsaWQpIHtcclxuICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMTtcclxuICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpIHtcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy52YWxpZFBsYWNlbWVudChwb3NpdGlvbiwgc2hpcC5sZW5ndGgsIGRpcmVjdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2VTaGlwKHNoaXAsIHBvc2l0aW9uLCBkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29udmVydFBvc2l0aW9uKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgbGV0IGNvbHVtbjtcclxuICAgICAgICBsZXQgc3RyID0gcG9zaXRpb24udG9TdHJpbmcoKTtcclxuICAgICAgICBsZXQgcm93O1xyXG4gICAgICAgIGlmIChwb3NpdGlvbiA8IDExKSB7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IHBvc2l0aW9uIC0gMTtcclxuICAgICAgICAgICAgcm93ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09IDEwMCkge1xyXG4gICAgICAgICAgICByb3cgPSA5O1xyXG4gICAgICAgICAgICBjb2x1bW4gPSA5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcm93ID0gcGFyc2VJbnQoc3RyLnNsaWNlKDAsIDEpKTtcclxuICAgICAgICAgICAgY29sdW1uID0gcGFyc2VJbnQoc3RyLnNsaWNlKDEsIDIpKSAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBzdHJSb3cgPSByb3cudG9TdHJpbmcoKTtcclxuICAgICAgICBsZXQgc3RyQ29sID0gY29sdW1uLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gc3RyUm93ICsgc3RyQ29sO1xyXG4gICAgICAgIHJldHVybiBuZXdQb3NpdGlvbjtcclxuICAgIH1cclxuICAgIGdldENvbChzdHIpIHtcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoc3RyLnNsaWNlKDEsIDIpKTtcclxuICAgIH1cclxuICAgIGdldFJvdyhzdHIpIHtcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoc3RyLnNsaWNlKDAsIDEpKTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBHYW1lQm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcclxuZXhwb3J0IGNsYXNzIFBsYXllciB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBvcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5nYW1lYm9hcmQgPSBuZXcgR2FtZUJvYXJkKCk7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnNob3RzID0gW107XHJcbiAgICAgICAgdGhpcy5vcG9uZW50ID0gb3BvbmVudDtcclxuICAgIH1cclxuICAgIGF0dGFjayhwb3NpdGlvbiwgb3BvbmVudCkge1xyXG4gICAgICAgIGxldCBuZXdQb3NpdGlvbiA9IHRoaXMuZ2FtZWJvYXJkLmNvbnZlcnRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgICAgbGV0IHJvdyA9IHRoaXMuZ2FtZWJvYXJkLmdldFJvdyhuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgbGV0IGNvbCA9IHRoaXMuZ2FtZWJvYXJkLmdldENvbChuZXdQb3NpdGlvbik7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNob3RzLmluY2x1ZGVzKHBvc2l0aW9uKSkge1xyXG4gICAgICAgICAgICB0aGlzLnNob3RzLnB1c2gocG9zaXRpb24pO1xyXG4gICAgICAgICAgICBvcG9uZW50LmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKHJvdywgY29sKTtcclxuICAgICAgICAgICAgaWYgKG9wb25lbnQuZ2FtZWJvYXJkLmlzT3ZlcigpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImdnXCIpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByYW5kb21BdHRhY2sob3Bwb25lbnQpIHtcclxuICAgICAgICBsZXQgdmFsaWRTaG90ID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uO1xyXG4gICAgICAgIHdoaWxlICghdmFsaWRTaG90KSB7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKSArIDE7XHJcbiAgICAgICAgICAgIGxldCBuZXdQb3NpdGlvbiA9IHRoaXMuZ2FtZWJvYXJkLmNvbnZlcnRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGxldCByb3cgPSB0aGlzLmdhbWVib2FyZC5nZXRSb3cobmV3UG9zaXRpb24pO1xyXG4gICAgICAgICAgICBsZXQgY29sID0gdGhpcy5nYW1lYm9hcmQuZ2V0Q29sKG5ld1Bvc2l0aW9uKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3RzLmluY2x1ZGVzKHBvc2l0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG90cy5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIG9wcG9uZW50LmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKHJvdywgY29sKTtcclxuICAgICAgICAgICAgICAgIHZhbGlkU2hvdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3RyO1xyXG4gICAgICAgICAgICAgICAgc3RyID0gcm93LnRvU3RyaW5nKCkgKyBjb2wudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFNoaXAge1xyXG4gICAgY29uc3RydWN0b3IobGVuZ3RoLCBuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XHJcbiAgICAgICAgdGhpcy5pc0hpdCA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3VuayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB9XHJcbiAgICBoaXQocG9zaXRpb24pIHtcclxuICAgICAgICAvL3B1c2ggcG9zaXRpb24gdG8gaXNoaXQgYXJyYXlcclxuICAgICAgICBpZiAoIXRoaXMuaXNIaXQuaW5jbHVkZXMocG9zaXRpb24pICYmIHRoaXMuaXNIaXQubGVuZ3RoIDwgdGhpcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0hpdC5wdXNoKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNIaXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaXNTdW5rKCkge1xyXG4gICAgICAgIC8vY2hlY2tzIGVhY2ggcG9zaXRpb24gb2Ygc2hpcCBmb3IgaGl0cyBpZiBhbGwgYXJlIGhpdCBpcyBzdW5rXHJcbiAgICAgICAgaWYgKHRoaXMuaXNIaXQubGVuZ3RoID09PSB0aGlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1bmsgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9mYWN0b3JpZXMvcGxheWVyc1wiO1xyXG5pbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4uL2ZhY3Rvcmllcy9zaGlwXCI7XHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlbmRlckdyaWRzKHBsYXllck5hbWUpIHtcclxuICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgICBjb25zdCBncmlkMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLWNvbnRhaW5lcjEnKTtcclxuICAgIGNvbnN0IHRpdGxlMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aXRsZS0xJyk7XHJcbiAgICB0aXRsZTEudGV4dENvbnRlbnQgPSBwbGF5ZXJOYW1lO1xyXG4gICAgY29uc3Qgc3Vua2VuMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdW5rZW4xJyk7XHJcbiAgICBjb25zdCBncmlkMiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLWNvbnRhaW5lcjInKTtcclxuICAgIGNvbnN0IHRpdGxlMiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aXRsZS0yJyk7XHJcbiAgICB0aXRsZTIudGV4dENvbnRlbnQgPSBcIkNvbXB1dGVyXCI7XHJcbiAgICBjb25zdCBzdW5rZW4yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1bmtlbjInKTtcclxuICAgIGxldCBodW1hbiA9IG5ldyBQbGF5ZXIoXCJodW1hblwiLCBcImNvbXB1dGVyXCIpO1xyXG4gICAgbGV0IGNvbXB1dGVyID0gbmV3IFBsYXllcihcImNvbXB1dGVyXCIsIFwiaHVtYW5cIik7XHJcbiAgICBsZXQgaEJvYXJkID0gaHVtYW4uZ2FtZWJvYXJkLmJvYXJkO1xyXG4gICAgbGV0IGNCb2FyZCA9IGNvbXB1dGVyLmdhbWVib2FyZC5ib2FyZDtcclxuICAgIGxldCBoQ2FycmllciA9IG5ldyBTaGlwKDUsIFwiY2FycmllclwiKTtcclxuICAgIGxldCBoRGVzdHJveWVyID0gbmV3IFNoaXAoNCwgXCJkZXN0cm95ZXJcIik7XHJcbiAgICBsZXQgaFN1Ym1hcmluZSA9IG5ldyBTaGlwKDMsIFwic3VibWFyaW5lXCIpO1xyXG4gICAgbGV0IGhQYXRyb2wgPSBuZXcgU2hpcCgyLCBcInBhdHJvbFwiKTtcclxuICAgIGxldCBjQ2FycmllciA9IG5ldyBTaGlwKDUsIFwiY2FycmllclwiKTtcclxuICAgIGxldCBjRGVzdHJveWVyID0gbmV3IFNoaXAoNCwgXCJkZXN0cm95ZXJcIik7XHJcbiAgICBsZXQgY1N1Ym1hcmluZSA9IG5ldyBTaGlwKDMsIFwic3VibWFyaW5lXCIpO1xyXG4gICAgbGV0IGNQYXRyb2wgPSBuZXcgU2hpcCgyLCBcInBhdHJvbFwiKTtcclxuICAgIGNvbnN0IGh1bWFuU2hpcHMgPSBbaENhcnJpZXIsIGhEZXN0cm95ZXIsIGhTdWJtYXJpbmUsIGhQYXRyb2xdO1xyXG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9IFtjQ2FycmllciwgY0Rlc3Ryb3llciwgY1N1Ym1hcmluZSwgY1BhdHJvbF07XHJcbiAgICAvLyBhbGxTaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xyXG4gICAgLy8gICAgIGNvbXB1dGVyLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICAvLyAgICAgaHVtYW4uZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgIC8vIH0pXHJcbiAgICBjb21wdXRlclNoaXBzLmZvckVhY2goc2hpcCA9PiB7XHJcbiAgICAgICAgY29tcHV0ZXIuZ2FtZWJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcyhzaGlwKTtcclxuICAgIH0pO1xyXG4gICAgaHVtYW5TaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xyXG4gICAgICAgIGh1bWFuLmdhbWVib2FyZC5yYW5kb21seVBsYWNlU2hpcHMoc2hpcCk7XHJcbiAgICB9KTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaEJvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBoQm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiaHBvc2l0aW9uXCIsIGhCb2FyZFtpXVtqXSk7XHJcbiAgICAgICAgICAgIC8vIGdyaWRJdGVtLnRleHRDb250ZW50ID0gYm9hcmRbaV1bal1cclxuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGhCb2FyZFtpXVtqXSkpIHtcclxuICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ3NoaXAtaGVyZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ2dyaWQtaXRlbScpO1xyXG4gICAgICAgICAgICBncmlkMSA9PT0gbnVsbCB8fCBncmlkMSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3JpZDEuYXBwZW5kQ2hpbGQoZ3JpZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY0JvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjQm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uc2V0QXR0cmlidXRlKFwiY3Bvc2l0aW9uXCIsIGNCb2FyZFtpXVtqXSk7XHJcbiAgICAgICAgICAgIC8vIGdyaWRJdGVtLnRleHRDb250ZW50ID0gYm9hcmRbaV1bal1cclxuICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZCgnZ3JpZC1pdGVtJyk7XHJcbiAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ2FpLWdyaWQnKTtcclxuICAgICAgICAgICAgZ3JpZEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoY0JvYXJkW2ldW2pdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWRJdGVtLmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpc1N1bmsgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlci5nYW1lYm9hcmQucmVjaWV2ZUF0dGFjayhpLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlci5nYW1lYm9hcmQucGxhY2VkU2hpcHMuZm9yRWFjaCgoc2hpcCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGlwLm5hbWUgPT09IGNCb2FyZFtpXVtqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTdW5rID0gc2hpcC5zdW5rO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N1bmspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Vua2VuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vua2VuLnRleHRDb250ZW50ID0gY0JvYXJkW2ldW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdW5rZW4yID09PSBudWxsIHx8IHN1bmtlbjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN1bmtlbjIuYXBwZW5kQ2hpbGQoc3Vua2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXB1dGVyLmdhbWVib2FyZC5pc092ZXIoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJZb3Ugd2luXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LmFkZCgnbWlzcycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1Bvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgbmV3UG9zaXRpb24gPSBjb21wdXRlci5yYW5kb21BdHRhY2soaHVtYW4pO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJvdyA9IGh1bWFuLmdhbWVib2FyZC5nZXRSb3cobmV3UG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvbCA9IGh1bWFuLmdhbWVib2FyZC5nZXRDb2wobmV3UG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtocG9zaXRpb249XCIke25ld1Bvc2l0aW9ufVwiXWApO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGhCb2FyZFtyb3ddW2NvbF0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLmNsYXNzTGlzdC5hZGQoJ21pc3MnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGdyaWQyID09PSBudWxsIHx8IGdyaWQyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncmlkMi5hcHBlbmRDaGlsZChncmlkSXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgZ3JpZEl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ3JpZC1pdGVtJyk7XHJcbn1cclxuIiwiLy8gaW1wb3J0ICcuL3N0eWxlcy5jc3MnXHJcbmltcG9ydCByZW5kZXJHcmlkcyBmcm9tIFwiLi91aS9yZW5kZXJHYW1lQm9hcmRzXCI7XHJcbi8vIHN0YXJ0R2FtZSgpXHJcbnJlbmRlckdyaWRzKCdqamNyYXp5bWFuJyk7XHJcbiJdLCJuYW1lcyI6WyJHYW1lQm9hcmQiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJib2FyZCIsImNyZWF0ZUJvYXJkIiwiaGl0cyIsIm1pc3NlcyIsInBsYWNlZFNoaXBzIiwiZ2FtZU92ZXIiLCJzdW5rU2hpcHMiLCJjb3VudCIsImkiLCJqIiwicGxhY2VTaGlwIiwic2hpcCIsInN0YXJ0IiwidmVydGljYWwiLCJ2YWxpZFBsYWNlbWVudCIsImxlbmd0aCIsImluY2x1ZGVzIiwiaW5kZXgiLCJpbmRleE9mIiwibmFtZSIsInB1c2giLCJyZWNpZXZlQXR0YWNrIiwicm93IiwiY29sdW1uIiwicG9zaXRpb24iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJmb3JFYWNoIiwiaGl0IiwiaXNTdW5rIiwiaXNPdmVyIiwiaXNWZXJ0aWNhbCIsIm5ld1Bvc2l0aW9uIiwiY29udmVydFBvc2l0aW9uIiwiZ2V0Um93IiwiZ2V0Q29sIiwicmFuZG9tbHlQbGFjZVNoaXBzIiwiZGlyZWN0aW9uIiwidmFsaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdHIiLCJ0b1N0cmluZyIsInBhcnNlSW50Iiwic2xpY2UiLCJQbGF5ZXIiLCJvcG9uZW50IiwiZ2FtZWJvYXJkIiwic2hvdHMiLCJhdHRhY2siLCJjb2wiLCJyYW5kb21BdHRhY2siLCJvcHBvbmVudCIsInZhbGlkU2hvdCIsImNvbnNvbGUiLCJsb2ciLCJTaGlwIiwiaXNIaXQiLCJzdW5rIiwicGxheWVyTmFtZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImdyaWQxIiwidGV4dENvbnRlbnQiLCJncmlkMiIsInN1bmtlbjIiLCJodW1hbiIsImNvbXB1dGVyIiwiaEJvYXJkIiwiY0JvYXJkIiwiaHVtYW5TaGlwcyIsImdyaWRJdGVtIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZENoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1bmtlbiIsImFsZXJ0IiwiaXRlbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyZW5kZXJHcmlkcyJdLCJzb3VyY2VSb290IjoiIn0=